<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
			<meta name="description" content="A weekly log of my attempts to bootstrap myself - 4th post">
		
		<link rel="stylesheet" href="https:&#x2F;&#x2F;hugodaniel.com&#x2F;css&#x2F;base.css">
		
			<link rel="alternate" type="application/rss+xml" title="RSS" href="https:&#x2F;&#x2F;hugodaniel.com&#x2F;rss.xml">
		
		
		
		<meta name="twitter:card" content="summary">
		<meta name="twitter:site" content="@mr_hugo">
		<meta name="twitter:creator" content="@mr_hugo">
		
			<title>Bootstrapping - getting some boots to strap</title>
			<meta name="twitter:title" content="Bootstrapping - getting some boots to strap">
			<meta property="og:title" content="Bootstrapping - getting some boots to strap">
			<meta property="og:type" content="article" >
		
		
			<meta name="twitter:description" content="A weekly log of my attempts to bootstrap myself - 4th post">
			<meta property="og:description" content="A weekly log of my attempts to bootstrap myself - 4th post">
		
		
			<meta property="og:article:published_time" content="2016-08-11">
		
		<meta property="og:url" content="https:&#x2F;&#x2F;hugodaniel.com&#x2F;posts&#x2F;bootstrapping4&#x2F;">
		
		<!-- Matomo -->
		<script type="text/javascript">
			var _paq = window._paq = window._paq || [];
			/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
			_paq.push(['trackPageView']);
			_paq.push(['enableLinkTracking']);
			(function() {
				var u="//vistas.hugodaniel.pt/";
				_paq.push(['setTrackerUrl', u+'matomo.php']);
				_paq.push(['setSiteId', '2']);
				var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
				g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
			})();
		</script>
		<noscript><p><img src="//vistas.hugodaniel.pt/matomo.php?idsite=2&amp;rec=1" style="border:0;" alt="" /></p></noscript>
		<!-- End Matomo Code -->
	</head>
	<body>
		
<main role="main"> 
	<article>
		<header>
			<h1> Bootstrapping - getting some boots to strap </h1>
			<p> A weekly log of my attempts to bootstrap myself - 4th post </p>
			<nav>
				<time datetime="2016-08-11">11-Aug-2016</time>
				<span>
					<a id="back" href="/">About me</a>
					<a target="_blank" href="http://www.twitter.com/mr_hugo" rel="external nofollow">@mr_hugo</a>
					<a href="/posts">All posts</a>
				</span>
			</nav>
		</header>
		<p>A lot has happened since the last post on this series. Against all odds the portuguese football team won the Euro2016, their first international cup! Summer also hit us hard shortly after that, heavy migrations towards the south (algarve) and the &quot;fire season&quot; started, consuming the green portions of this rectangular land.</p>
<p>Amidst all of these events it became clear to me that i needed a backup plan in order to extend my window of development time for the paint.pt project.</p>
<p>So during the month of July i took a one month course in how to teach and give formation and got a &quot;certification of pedagogical competences&quot; (aka teaching certification). This was a great time, i learned a lot, practiced a lot and read a lot about teaching and group interactions.</p>
<p>Now i only need to start practicing it in a way that does not harm the time I have to work on paint.pt. Are you in need of some coding lessons ? :)</p>
<h2 id="in-august">In August</h2>
<p>August is a very special month in portuguese culture. Nothing happens in august. Everything stops and services work in half speed (which in most cases is a synonym to stop).</p>
<p>Not me, i'm not a big fan of crowded beaches and hope to take the time to restart coding on paint.pt (that almost stopped during july).</p>
<p>For this month of August my plan is to finish the menu system and start painting :D. I already finished the <a href="http://www.paint.pt">logo and loading animation</a>. So stay tuned.</p>
<p>If you enjoy reading this please consider subscribing with your e-mail so we can stay in contact.</p>
<p>Check out the other &quot;bootstrapping&quot; posts: <a href="https://hugodaniel.com/posts/bootstrapping1/">Bootstrapping 1</a>, <a href="https://hugodaniel.com/posts/bootstrapping2/">Bootstrapping 2</a> and <a href="https://hugodaniel.com/posts/bootstrapping3/">Bootstrapping 3</a>.</p>

	</article>
	<hr>
	<footer>
		<nav>
			<a target="_blank" href="https://github.com/HugoDaniel" rel="external nofollow">GitHub</a>
			<a target="_blank" href="https://twitter.com/mr_hugo" rel="external nofollow">Twitter</a>
			<a target="_blank" href="https://www.linkedin.com/in/mrhugogomes/" rel="external nofollow">LinkedIN</a>
			<a href="mailto:hello@hugodaniel.com">e-mail</a>
		</nav>
	</footer>
</main>


	<!--
		<footer>
			<div>
				<p>Latest project</p>
				<a href="https://gridgenerator.com" target="_blank">Grid Generator</a>
			</div>
			<nav>
				<a target="_blank" href="https://twitter.com/mr_hugo">
					<img src="https:&#x2F;&#x2F;hugodaniel.com&#x2F;images&#x2F;twitter.svg" alt="Twitter" />
				</a>
				<a target="_blank" href="https://github.com/HugoDaniel">
					<img src="https:&#x2F;&#x2F;hugodaniel.com&#x2F;images&#x2F;github.svg" alt="GitHub" />
				</a>
				<a target="_blank" href="https://www.linkedin.com/in/mrhugogomes/">
					<img src="https:&#x2F;&#x2F;hugodaniel.com&#x2F;images&#x2F;linkedin.svg" alt="LinkedIn" />
				</a>
			</nav>
			<div>
				<p>Liked what you read ?</p>
				<a href="mailto:mail@hugodaniel.pt">Say hello :)!</a>
			</div>
		</footer>
	-->
		<script>
			console.log({
  "config": {
    "base_url": "https://hugodaniel.com",
    "theme": null,
    "title": null,
    "description": null,
    "default_language": "en",
    "languages": [],
    "translations": {},
    "highlight_code": true,
    "highlight_theme": "base16-ocean-dark",
    "generate_feed": true,
    "feed_limit": null,
    "feed_filename": "atom.xml",
    "hard_link_static": false,
    "taxonomies": [],
    "compile_sass": false,
    "minify_html": false,
    "build_search_index": true,
    "ignored_content": [],
    "extra_syntaxes": [],
    "link_checker": {
      "skip_prefixes": [],
      "skip_anchor_prefixes": []
    },
    "slugify": {
      "paths": "on",
      "taxonomies": "on",
      "anchors": "on"
    },
    "search": {
      "include_title": true,
      "include_content": true,
      "truncate_content_length": null,
      "include_description": false
    },
    "extra": {}
  },
  "current_path": "/posts/bootstrapping4/",
  "current_url": "https://hugodaniel.com/posts/bootstrapping4/",
  "lang": "en",
  "page": {
    "relative_path": "posts/2016-08-11-bootstrapping4.md",
    "content": "<p>A lot has happened since the last post on this series. Against all odds the portuguese football team won the Euro2016, their first international cup! Summer also hit us hard shortly after that, heavy migrations towards the south (algarve) and the &quot;fire season&quot; started, consuming the green portions of this rectangular land.</p>\n<p>Amidst all of these events it became clear to me that i needed a backup plan in order to extend my window of development time for the paint.pt project.</p>\n<p>So during the month of July i took a one month course in how to teach and give formation and got a &quot;certification of pedagogical competences&quot; (aka teaching certification). This was a great time, i learned a lot, practiced a lot and read a lot about teaching and group interactions.</p>\n<p>Now i only need to start practicing it in a way that does not harm the time I have to work on paint.pt. Are you in need of some coding lessons ? :)</p>\n<h2 id=\"in-august\">In August</h2>\n<p>August is a very special month in portuguese culture. Nothing happens in august. Everything stops and services work in half speed (which in most cases is a synonym to stop).</p>\n<p>Not me, i'm not a big fan of crowded beaches and hope to take the time to restart coding on paint.pt (that almost stopped during july).</p>\n<p>For this month of August my plan is to finish the menu system and start painting :D. I already finished the <a href=\"http://www.paint.pt\">logo and loading animation</a>. So stay tuned.</p>\n<p>If you enjoy reading this please consider subscribing with your e-mail so we can stay in contact.</p>\n<p>Check out the other &quot;bootstrapping&quot; posts: <a href=\"https://hugodaniel.com/posts/bootstrapping1/\">Bootstrapping 1</a>, <a href=\"https://hugodaniel.com/posts/bootstrapping2/\">Bootstrapping 2</a> and <a href=\"https://hugodaniel.com/posts/bootstrapping3/\">Bootstrapping 3</a>.</p>\n",
    "permalink": "https://hugodaniel.com/posts/bootstrapping4/",
    "slug": "bootstrapping4",
    "ancestors": [
      "_index.md",
      "posts/_index.md"
    ],
    "title": "Bootstrapping - getting some boots to strap",
    "description": "A weekly log of my attempts to bootstrap myself - 4th post",
    "updated": null,
    "date": "2016-08-11",
    "year": 2016,
    "month": 8,
    "day": 11,
    "taxonomies": {},
    "extra": {
      "place": "Lisboa",
      "author": "Hugo Daniel"
    },
    "path": "/posts/bootstrapping4/",
    "components": [
      "posts",
      "bootstrapping4"
    ],
    "summary": null,
    "toc": [
      {
        "level": 2,
        "id": "in-august",
        "permalink": "https://hugodaniel.com/posts/bootstrapping4/#in-august",
        "title": "In August",
        "children": []
      }
    ],
    "word_count": 299,
    "reading_time": 2,
    "assets": [],
    "draft": false,
    "lang": "en",
    "lighter": null,
    "heavier": null,
    "earlier": {
      "relative_path": "posts/2016-06-24-bootstrapping3.md",
      "content": "<p>This week was a blast! I took 3 days off and only worked thursday and friday.</p>\n<p>This wasn't entirely on purpose, my intention was not to have real &quot;vacations&quot;, but to enjoy the overall Lisbon party mood. Tuesday was also the first game of the portuguese football team in euro 2016.</p>\n<p>Though i am not a football fan, i do like to watch the portuguese team play with the eventuality of seeing some magical moves by Cristiano Ronaldo.</p>\n<p><img src=\"/images/ronaldo.jpg\" alt=\"Cristiano Ronaldo 2012\" /></p>\n<p>I know by experience that everything stops here in portugal when a big football match is going to happen. This is a strong motivator to go out drink some beers with friends in antecipation for the game.</p>\n<p>It is important to note that a win by the home team is one of the best excuses to party hard. Unfortunately we did not win, it was a tie with Iceland, which meant no after party as a huge victory was expected.</p>\n<p>Still it is better to enjoy the day than to stress with &quot;having something to do&quot;. Let the work be done on more appropriate days.</p>\n<h2 id=\"3rd-week\">3rd Week</h2>\n<p>The two remaining work days i wrote the <a href=\"https://hugodaniel.com/posts/react-redux-canvas/\">introductory post</a> on &quot;<a href=\"https://github.com/HugoDaniel/redux-canvas\">redux-canvas</a> and release it on npm together with a simple usage example.</p>\n<p>This is going to be the basis of the paint application as it allows canvas (which is crippled with side-effects) to be used directly in pure redux actions.</p>\n<p>And it was it. If you enjoy reading this please consider subscribing with your e-mail so we can stay in contact (i will personally send you an e-mail).</p>\n<p>Check out the other &quot;bootstrapping&quot; posts: <a href=\"https://hugodaniel.com/posts/bootstrapping1/\">Bootstrapping 1</a>, <a href=\"https://hugodaniel.com/posts/bootstrapping2/\">Bootstrapping 2</a> and <a href=\"https://hugodaniel.com/posts/bootstrapping4/\">Bootstrapping 4</a>.</p>\n",
      "permalink": "https://hugodaniel.com/posts/bootstrapping3/",
      "slug": "bootstrapping3",
      "ancestors": [
        "_index.md",
        "posts/_index.md"
      ],
      "title": "Bootstrapping - week 3",
      "description": "A weekly log of my attempts to bootstrap myself - 3rd week",
      "updated": null,
      "date": "2016-06-24",
      "year": 2016,
      "month": 6,
      "day": 24,
      "taxonomies": {},
      "extra": {
        "place": "Lisboa",
        "author": "Hugo Daniel"
      },
      "path": "/posts/bootstrapping3/",
      "components": [
        "posts",
        "bootstrapping3"
      ],
      "summary": null,
      "toc": [
        {
          "level": 2,
          "id": "3rd-week",
          "permalink": "https://hugodaniel.com/posts/bootstrapping3/#3rd-week",
          "title": "3rd Week",
          "children": []
        }
      ],
      "word_count": 316,
      "reading_time": 2,
      "assets": [],
      "draft": false,
      "lang": "en",
      "lighter": null,
      "heavier": null,
      "earlier": null,
      "later": null,
      "translations": []
    },
    "later": {
      "relative_path": "posts/2016-09-23-how-fast-is-nothing.md",
      "content": "<p>One of the fastest functions that can be run inside <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame\">requestAnimationFrame</a> goes something like this:</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#c0c5ce;\">\nfunction fastest() {\n  window.requestAnimationFrame(fastest);\n}\nwindow.requestAnimationFrame(fastest);\n\n</span></code></pre>\n<p>A simple no-op. It does nothing besides requesting to be called in another frame in order to do nothing besides requesting to be called in another frame, and so on.\nA request for nothing that hopefully matches the speed of your monitor v-sync to hastily do just nothing.</p>\n<p>Which gives us the perfect chance to use the most important skill we have in our life.</p>\n<h2 id=\"giving-meaning-to-nothing\">Giving meaning to nothing</h2>\n<p>Measuring the function can be done by <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Performance/mark\">placing marks</a> and then collecting them with the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Performance/measure\">performance.measure() function</a>. To avoid placing a mark every frame lets also count them and place it only once every 120 frames. My monitor updates at about 60Hz so this should place a mark every 2 seconds.</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#c0c5ce;\">let count = 0;\n// ^ count each frame\nfunction fastest() {\n  window.requestAnimationFrame(fastest);\n  count += 1;\n  if(count === 120) {\n    performance.mark(&quot;120&quot;);\n    // ^ place a mark in the 120th\n }\n}\nperformance.mark(&quot;0&quot;);\n// ^ place a mark before the first frame\nwindow.requestAnimationFrame(fastest);\nwindow.setTimeout(function() {\n  // measure the duration between those two marks;\n  performance.measure(&quot;120frames&quot;, &quot;0&quot;, &quot;120&quot;);\n  const measure = performance.getEntriesByType(&quot;measure&quot;)[0];\n  console.log(&quot;120 frames in: &quot; + measure.duration);\n}, 3000);\n\n</span></code></pre>\n<p>At 60fps we get around 16.7ms per frame, 120 frames should run in ~2000ms. Yet after 3 seconds this code prints &quot;120 frames in: 2148.415&quot; in the console.\nThis is 8% slower, making it closer to 55fps (18.2ms) than to 60fps(16.7ms).</p>\n<p>If you thrive in the eccentricities of speed then those 1.5ms are simply unacceptable, lets try to understand what is happening by opening the &quot;Performance&quot; tab in the developer tools.</p>\n<h2 id=\"the-eyes-are-the-window-of-the-soul-and-all-i-see-is-garbage\">The eyes are the window of the soul. And all i see is garbage.</h2>\n<p><img src=\"/images/measure1.png\" alt=\"Screenshot of the performance monitor of Firefox developer tools, it shows a maximum of 60 frames-per-second, a minimum 5.41 frames-per-second, and an average of 55.85 frames-per-second.\" /></p>\n<p>Those big drops in performance are related to the red dots of the Garbage Collector (from here on, just &quot;GC&quot;). They mark the time where GC woke up and run through the nursery of temporary objects to clean them.</p>\n<p>These GC actions happen at the rate that the code fills the nursery heap with temporary objects. The browser then performs a small cleanup on the nursery heap and checks if some of those temporary objects can be promoted to the tenured heap.</p>\n<p>The Tenured heap fills at a much lower rate than the Nursery and consequently the browser does not check it as often as the Nursery.</p>\n<p>Lets try to promote all our short lived objects into something that might be selected to be tenured by the browser, thus reducing the time that the GC spends analyzing our running code and the nursery heap.</p>\n<h2 id=\"the-execution-context-is-dead-long-live-the-execution-context\">The execution context is dead. Long live the execution context!</h2>\n<p>My first approach is to remove the first invocation to the requestAnimationFrame() and place it inside a global closure in <a href=\"https://en.wikipedia.org/wiki/Immediately-invoked_function_expression\">IIFE</a> style.</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#c0c5ce;\">let count = 0;\n(function() {\n  function fastest() {\n    window.requestAnimationFrame(fastest);\n    count += 1;\n    if(count === 120) {\n      performance.mark(&quot;120&quot;);\n    }\n  }\n  performance.mark(&quot;0&quot;);\n  fastest();\n  // ^ call the function directly for the first frame\n})();\n// ^ IIFE\n</span></code></pre>\n<p>The idea here is to make the reference to the fastest() function explicitly last for the whole execution of the animation loop by wrapping it in a closure context that is immediatly called.</p>\n<p>The next step is to remove all obvious objects allocations that happen inside our loop.\nThis means we need to remove all the strings (&quot;120&quot; is an object allocation) and all the numbers.</p>\n<p>One of the great things about closures is that their execution context is available in their children, this means we can place the strings and numbers of our loop in vars in the long-lived closure context instead, making them live between our loop function calls.</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#c0c5ce;\">(function () {\n  let count = 0;\n  const limit = 120;\n  const lastMark = &quot;120&quot;;\n  const firstMark = &quot;0&quot;;\n  // ^ all vars go here\n  function fastest() {\n    window.requestAnimationFrame(fastest);\n    count += 1;\n    if(count === limit) {\n      performance.mark(lastMark);\n    }\n  }\n  // ^ when the fastest() context finishes there\n  // are no obvious object allocations to free\n  performance.mark(firstMark);\n  fastest();\n})();\n// setTimeout remains the same, this is just for performance measure\nwindow.setTimeout(function() {\n  performance.measure(&quot;120frames&quot;, &quot;0&quot;, &quot;120&quot;);\n  const totalTime = performance.getEntriesByType(&quot;measure&quot;)[0].duration;\n  console.log(&quot;120 frames in: &quot; + totalTime);\n}, 3000);\n</span></code></pre><h2 id=\"a-speed-freak-nighmare-is-a-control-junkie-best-dream\">A speed-freak nighmare is a control-junkie best dream</h2>\n<p>That code above produces the string &quot;120 frames in: 1990.69&quot;. This is great, it says that our measures were taken before the 16.7ms frame time has passed.</p>\n<p>Lets look at the performance tab:</p>\n<p><img src=\"/images/measure2.png\" alt=\"Screenshot of the performance monitor of Firefox developer tools, it shows a maximum of 60 frames-per-second, a minimum 38.98 frames-per-second, and an average of 57.66 frames-per-second.\" /></p>\n<p>Note that the Nursery is completely gone from our call-stack. There are still some red dots that mostly refer to the Cycle Collector (from here on, just &quot;CC&quot;) taking control of the code.</p>\n<p>The CC does a simple job: it tracks cycles in the code.</p>\n<p>A cycle happens when objects refer to each other in a way that their reference count never becomes zero. This can trick the GC to never collect them and forces the need to have a cycle counter running through the code once in a while.</p>\n<p>The CC is a tricky beast, it does not allow anything else to run while it is running. Our JavaScript stops executing (you can validate this by increasing the zoom on the developer tools waterfall when a CC action occurs).</p>\n<p>Fortunately this is not hurting the performance that much and each frame gets rendered bellow their time by the browser. I was starting to have some chills with the idea of having to frame limit the render loop to ensure a constant frame rate.</p>\n<p>Thankfully this Intel HD3000 is still good for Nothing at all :)</p>\n<p><img src=\"/images/intel.png\" alt=\"Screenshot of the chrome://gpu page list of problems. Currently chrome does not support WebGL in Intel HD3000 cards on OSX.\" /></p>\n<p>Thanks <a href=\"https://twitter.com/rqleve\">Raquel Foster</a> for reading this blog and motivating me to write this follow-up on <a href=\"https://hugodaniel.com/posts/react-redux-canvas/\">React-Redux-Canvas</a>.</p>\n",
      "permalink": "https://hugodaniel.com/posts/how-fast-is-nothing/",
      "slug": "how-fast-is-nothing",
      "ancestors": [
        "_index.md",
        "posts/_index.md"
      ],
      "title": "How fast is nothing at all ?",
      "description": "Running and measuring no-op code in a requestAnimationFrame()",
      "updated": null,
      "date": "2016-09-23",
      "year": 2016,
      "month": 9,
      "day": 23,
      "taxonomies": {},
      "extra": {
        "place": "Lisboa",
        "author": "Hugo Daniel"
      },
      "path": "/posts/how-fast-is-nothing/",
      "components": [
        "posts",
        "how-fast-is-nothing"
      ],
      "summary": null,
      "toc": [
        {
          "level": 2,
          "id": "giving-meaning-to-nothing",
          "permalink": "https://hugodaniel.com/posts/how-fast-is-nothing/#giving-meaning-to-nothing",
          "title": "Giving meaning to nothing",
          "children": []
        },
        {
          "level": 2,
          "id": "the-eyes-are-the-window-of-the-soul-and-all-i-see-is-garbage",
          "permalink": "https://hugodaniel.com/posts/how-fast-is-nothing/#the-eyes-are-the-window-of-the-soul-and-all-i-see-is-garbage",
          "title": "The eyes are the window of the soul. And all i see is garbage.",
          "children": []
        },
        {
          "level": 2,
          "id": "the-execution-context-is-dead-long-live-the-execution-context",
          "permalink": "https://hugodaniel.com/posts/how-fast-is-nothing/#the-execution-context-is-dead-long-live-the-execution-context",
          "title": "The execution context is dead. Long live the execution context!",
          "children": []
        },
        {
          "level": 2,
          "id": "a-speed-freak-nighmare-is-a-control-junkie-best-dream",
          "permalink": "https://hugodaniel.com/posts/how-fast-is-nothing/#a-speed-freak-nighmare-is-a-control-junkie-best-dream",
          "title": "A speed-freak nighmare is a control-junkie best dream",
          "children": []
        }
      ],
      "word_count": 1057,
      "reading_time": 6,
      "assets": [],
      "draft": false,
      "lang": "en",
      "lighter": null,
      "heavier": null,
      "earlier": null,
      "later": null,
      "translations": []
    },
    "translations": []
  }
});
		</script>
	</body>
</html>
