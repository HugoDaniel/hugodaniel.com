<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
			<meta name="description" content="Working, playing and measuring the JavaScript Set data structure">
		
		<link rel="stylesheet" href="https:&#x2F;&#x2F;hugodaniel.com&#x2F;css&#x2F;base.css">
		
			<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="https:&#x2F;&#x2F;hugodaniel.com&#x2F;atom.xml">
		
		
		
		<meta name="twitter:card" content="summary">
		<meta name="twitter:site" content="@mr_hugo">
		<meta name="twitter:creator" content="@mr_hugo">
		
			<title>How useful is the JavaScript Set</title>
			<meta name="twitter:title" content="How useful is the JavaScript Set">
			<meta property="og:title" content="How useful is the JavaScript Set">
			<meta property="og:type" content="article" >
		
		
			<meta name="twitter:description" content="Working, playing and measuring the JavaScript Set data structure">
			<meta property="og:description" content="Working, playing and measuring the JavaScript Set data structure">
		
		
			<meta property="og:article:published_time" content="2017-10-25">
		
		<meta property="og:url" content="https:&#x2F;&#x2F;hugodaniel.com&#x2F;posts&#x2F;how-useful-is-the-javascript-set&#x2F;">
		
		
		
		<!-- Matomo -->
		<script type="text/javascript">
			var _paq = window._paq = window._paq || [];
			/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
			_paq.push(['trackPageView']);
			_paq.push(['enableLinkTracking']);
			(function() {
				var u="//vistas.hugodaniel.pt/";
				_paq.push(['setTrackerUrl', u+'matomo.php']);
				_paq.push(['setSiteId', '2']);
				var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
				g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
			})();
		</script>
		<noscript><p><img src="//vistas.hugodaniel.pt/matomo.php?idsite=2&amp;rec=1" style="border:0;" alt="" /></p></noscript>
		<!-- End Matomo Code -->
	</head>
	<body>
		
<main role="main">


	<article>

		<header>
			<h1> How useful is the JavaScript Set </h1>
			<p> Working, playing and measuring the JavaScript Set data structure </p>
			<nav>
				<time datetime="2017-10-25">25-Oct-2017</time>
				<span>
					<a id="back" href="/">About me</a>
					<a href="/posts">All posts</a>
				</span>
			</nav>
		</header>
		<p>In most languages Set's have a clear strong use case: fast union, intersection and difference operations; unfortunately in JavaScript these operations are not readily defined so as an exercise I am going to raise some questions and try to answer them in this post.</p>
<p>All code is run on Firefox Developer Edition 57.0b11 (64-bit) in macOS.</p>
<h2 id="initialization">Initialization</h2>
<p>Most of this post will be used to compare <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">Set()</a> with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">Array()</a> for some common operations. To initialize a Set() I will be constructing it with an Array.</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#b48ead;">const </span><span style="color:#bf616a;">set1 </span><span style="color:#c0c5ce;">= new Set([</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">6</span><span style="color:#c0c5ce;">]);

</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">has</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">// true

</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">;
</span><span style="color:#65737e;">// Set [ 1, 2, 3, 4, 5, 6 ]
</span></code></pre><h2 id="uniqueness">Uniqueness</h2>
<p>Without the common set operations defined the JavaScript Set() can be seen as a glorified container that only stores unique elements. When you put a repeated element it actually replaces the existing one.</p>
<p>This is quite useful for primitive values.</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">);
</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">);
</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">);
</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">;
</span><span style="color:#65737e;">// Set [ 1, 2, 3, 4, 5, 6 ]
</span></code></pre>
<p>Unlike Arrays the value will not be repeated when you add it to a Set.</p>
<p>For object values this is not that simple as Set uses references for those values;</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#b48ead;">const </span><span style="color:#bf616a;">set2 </span><span style="color:#c0c5ce;">= new Set([{ value: </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">}, { value: </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">}]);
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">obj1 </span><span style="color:#c0c5ce;">= { value: </span><span style="color:#d08770;">2 </span><span style="color:#c0c5ce;">};
</span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">obj1</span><span style="color:#c0c5ce;">);
</span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">;
</span><span style="color:#65737e;">// Set [{ value: 1}, { value: 2}, { value: 2 }]
</span></code></pre>
<p>The reference is used as the key in the Set, if we change <code>obj1.value</code> above to something else and add it to the Set, JavaScript will see it as a repeated element and replace the existing reference in the Set.</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#bf616a;">obj1</span><span style="color:#c0c5ce;">.value = &quot;</span><span style="color:#a3be8c;">foo</span><span style="color:#c0c5ce;">&quot;;
</span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">obj1</span><span style="color:#c0c5ce;">); </span><span style="color:#65737e;">// obj1 is already in the set
</span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">;
</span><span style="color:#65737e;">// Set [{ value: 1}, { value: 2}, { value: &quot;foo&quot; }]
</span></code></pre>
<p>Now just to compare with Arrays, here is a naive implementation to create an array with n values and then filter the unique values in it.</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#b48ead;">const </span><span style="color:#bf616a;">n </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">100000</span><span style="color:#c0c5ce;">;
</span><span style="color:#65737e;">// create an array with &#39;n&#39; random numbers:
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">initialArray </span><span style="color:#c0c5ce;">= new Array();
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">number </span><span style="color:#c0c5ce;">= Math.</span><span style="color:#96b5b4;">round</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">random</span><span style="color:#c0c5ce;">()*</span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">);
	</span><span style="color:#bf616a;">initialArray</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">push</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">number</span><span style="color:#c0c5ce;">);
}
</span><span style="color:#65737e;">// naively filter the unique values into a new array
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">uniqueArray </span><span style="color:#c0c5ce;">= new Array();
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">UniqueArrayBefore</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">initialArray</span><span style="color:#c0c5ce;">.length; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">value </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">initialArray</span><span style="color:#c0c5ce;">[</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">];
	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">uniqueArray</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">indexOf</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">value</span><span style="color:#c0c5ce;">) === -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">) {
		</span><span style="color:#bf616a;">uniqueArray</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">push</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">value</span><span style="color:#c0c5ce;">);
	}
}
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">UniqueArrayAfter</span><span style="color:#c0c5ce;">&quot;);
performance.</span><span style="color:#8fa1b3;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">uniqueArray</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">UniqueArrayBefore</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">UniqueArrayAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">arrayTotalTime </span><span style="color:#c0c5ce;">= performance.</span><span style="color:#8fa1b3;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">uniqueArray</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].</span><span style="color:#bf616a;">duration</span><span style="color:#c0c5ce;">;
</span><span style="color:#ebcb8b;">console</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">arrayTotalTime</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">uniqueArray</span><span style="color:#c0c5ce;">.length);
</span><span style="color:#65737e;">// 171.08500000000004 63235
</span></code></pre>
<p>It takes 171 milliseconds to filter ~64k unique values in a 100k elments array. Not bad.</p>
<p>Now lets compare this naive implementation to just using Set():</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#c0c5ce;">performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">UniqueSetBefore</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">uniqueSet </span><span style="color:#c0c5ce;">= new Set(</span><span style="color:#bf616a;">initialArray</span><span style="color:#c0c5ce;">); </span><span style="color:#65737e;">// easy!
</span><span style="color:#c0c5ce;">performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">UniqueSetAfter</span><span style="color:#c0c5ce;">&quot;);
performance.</span><span style="color:#8fa1b3;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">uniqueSet</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">UniqueSetBefore</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">UniqueSetAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">setTotalTime </span><span style="color:#c0c5ce;">= performance.</span><span style="color:#8fa1b3;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">uniqueSet</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].</span><span style="color:#bf616a;">duration</span><span style="color:#c0c5ce;">;
</span><span style="color:#ebcb8b;">console</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">setTotalTime</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">uniqueSet</span><span style="color:#c0c5ce;">.size);
</span><span style="color:#65737e;">// 0.8699999999998909 63235
</span></code></pre>
<p>That is FAST! ~0.9ms with the same initial 100k array. The good part is that Set does not get worse with the number of elements in it.</p>
<p>This is basic JS and the killer feature of Set()'s. Use them when you need a container of unique elements and/or to filter unique elements in any iterable container.</p>
<h2 id="presence">Presence</h2>
<p>Checking if an element is present is also easy in a Set and arguably an operation quite common for containers like these.</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">has</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">// true
</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">has</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1337</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">// false
</span></code></pre>
<p>Arrays also have a presence function called <code>indexOf</code>: it returns the index of the element or -1 if it is not present.</p>
<p>To compare <code>Array.indexOf()</code> to <code>Set.has()</code> here is a quick test that runs 10000 indexOf's (in array) and has's (in Set) for an Array and Set of 100 elements:</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#b48ead;">const </span><span style="color:#bf616a;">size </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">100</span><span style="color:#c0c5ce;">; </span><span style="color:#65737e;">// the Array and Set size
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">a </span><span style="color:#c0c5ce;">= new Array();
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">push</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">round</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">random</span><span style="color:#c0c5ce;">()*</span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">));
}
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">s </span><span style="color:#c0c5ce;">= new Set(</span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">);

</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">ops </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">10000</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">indexAll </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array Before</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">ops</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">indexAll </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">indexOf</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">round</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">random</span><span style="color:#c0c5ce;">()*</span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">));
	</span><span style="color:#65737e;">// ^ just to do some operation
</span><span style="color:#c0c5ce;">}
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array After</span><span style="color:#c0c5ce;">&quot;);
performance.</span><span style="color:#8fa1b3;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array.indexOf()</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">Array Before</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">Array After</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">arrayTotalTime </span><span style="color:#c0c5ce;">= performance.</span><span style="color:#8fa1b3;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array.indexOf()</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].</span><span style="color:#bf616a;">duration</span><span style="color:#c0c5ce;">;

</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">setValue </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">false</span><span style="color:#c0c5ce;">;
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set Before</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">ops</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">setValue </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">s</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">has</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">round</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">random</span><span style="color:#c0c5ce;">()*</span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">));
	</span><span style="color:#65737e;">// ^ same as above just to do some operation
</span><span style="color:#c0c5ce;">}
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set After</span><span style="color:#c0c5ce;">&quot;);
performance.</span><span style="color:#8fa1b3;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set.has()</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">Set Before</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">Set After</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">setTotalTime </span><span style="color:#c0c5ce;">= performance.</span><span style="color:#8fa1b3;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set.has()</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].</span><span style="color:#bf616a;">duration</span><span style="color:#c0c5ce;">;

</span><span style="color:#ebcb8b;">console</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">setValue</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">indexAll</span><span style="color:#c0c5ce;">);
</span><span style="color:#ebcb8b;">console</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">SET: </span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#bf616a;">setTotalTime</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">ARRAY: </span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#bf616a;">arrayTotalTime</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">// SET:  17.68499999999767 ARRAY:  20.924999999995634
</span></code></pre>
<p>A slight difference. Multiple executions give values that are coherent with these (not an outlier).
<code>Set.has()</code> is faster than the <code>Array.indexOf()</code> even for small Arrays.</p>
<p>The difference of execution just gets bigger as the size of the containers increase.</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#65737e;">// size = 1000;
// SET:  21.014999999999418 ARRAY:  54.00500000000102
// size = 10000;
// SET:  17.44499999999971 ARRAY:  398.505000000001
// size = 100000;
// SET:  19.770000000004075 ARRAY:  3779.524999999994
</span></code></pre>
<p><code>Set.has()</code> execution time doesn't seem to differ with the set size. The JS spec tells us why:</p>
<p><em>&quot;Set objects must be implemented using either hash tables or other mechanisms that, on average, provide access times that are sublinear on the number of elements in the collection.&quot;</em> <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-set-objects">[*]</a></p>
<p>It does not even bother heating your CPU as my browser probably implements this to be O(shiznit(n)) for a large enough n (I will not go into detail here so I will leave the measurement as an exercise for you as it is always important/necessary to measure Big-O behaviours).</p>
<h2 id="insertion-speed">Insertion speed</h2>
<p>Right now Sets seem really cool, how about we check how fast is the add() method in comparison to an array push(), like we did in the <a href="https://hugodaniel.com/posts/in-loving-memory-of-immutable/">Immutable.List vs Array article</a> ?</p>
<p>The code is simple, two loops, one for Array.push() and another for Set.add().</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#b48ead;">const </span><span style="color:#bf616a;">s </span><span style="color:#c0c5ce;">= new Set();
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">a </span><span style="color:#c0c5ce;">= new Array();
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">ammount </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">100000</span><span style="color:#c0c5ce;">;
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">ArrayBefore</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">ammount</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">push</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">);
}
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">ArrayAfter</span><span style="color:#c0c5ce;">&quot;);
performance.</span><span style="color:#8fa1b3;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array.push</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">ArrayBefore</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">ArrayAfter</span><span style="color:#c0c5ce;">&quot;);

performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">SetBefore</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">ammount</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">s</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">);
}
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">SetAfter</span><span style="color:#c0c5ce;">&quot;);
performance.</span><span style="color:#8fa1b3;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set.add</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">SetBefore</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">SetAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">arrayTime </span><span style="color:#c0c5ce;">= performance.</span><span style="color:#8fa1b3;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array.push</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].</span><span style="color:#bf616a;">duration</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">setTime </span><span style="color:#c0c5ce;">= performance.</span><span style="color:#8fa1b3;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set.add</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].</span><span style="color:#bf616a;">duration</span><span style="color:#c0c5ce;">;
</span><span style="color:#ebcb8b;">console</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(`</span><span style="color:#a3be8c;">Array.push in ${</span><span style="color:#bf616a;">arrayTime</span><span style="color:#a3be8c;">}ms; Set.add in ${</span><span style="color:#bf616a;">setTime</span><span style="color:#a3be8c;">}ms;</span><span style="color:#c0c5ce;">`);
</span><span style="color:#65737e;">// Array.push in 4.054999999993015ms; Set.add in 20.915000000037253ms;
</span></code></pre>
<p>Ah! Arrays are much faster (5x) in insertion than Sets. If you are an experience developer this is not really surprising at all, but still it is nice to check.
Be aware that insertion speed grows linearly in Arrays and non-linearly in Sets:</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#65737e;">// ammount = 100000;
// Array.push in 4.054999999993015ms; Set.add in 20.915000000037253ms;
// ammount = 1000000;
// Array.push in 17.175000000046566ms; Set.add in 417.03999999992084ms;
// ^ ~4x more than prev.               ^ ~20x more than prev.
// ammount = 10000000;
// Array.push in 349.8299999999581ms; Set.add in 3902.625ms;
// ^ ~20x more than prev.             ^ ~10x more than prev.
</span></code></pre>
<p>We could continue, but JavaScript numbers are <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">64 bit double precision floating point values</a>. Which means that for integer values they will use 52bits of storage for the significand. Which in turn means that for the next ammount (100000000) I would need 650MB of memory just to store the numbers + the overhead of the Array and Set data structures.</p>
<p>Another exercise for the reader :D</p>
<p>If you are doing a cheap fast logger, then Array is a better choice than Set since it inserts much faster. Set add() is probably implemented to have a better <a href="https://en.wikipedia.org/wiki/Big_O_notation">O(some BS here)</a> than the Array push() and it will likely not be much slower than 10x the previous running order. But their measured absolute value is way slower and this is what really matters, always measure your code if you care about performance because overhead can creep in the most unexpected places (I am not sure if this is the case, but still...).</p>
<h2 id="iteration-speed">Iteration speed</h2>
<p>If you are wondering how Set performs in the need to iterate through its elements, wonder no further.</p>
<p>Again the two cycles, this time using for..of to go through the Set items.</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#b48ead;">const </span><span style="color:#bf616a;">s </span><span style="color:#c0c5ce;">= new Set();
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">a </span><span style="color:#c0c5ce;">= new Array();
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">ammount </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">100000</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">sum </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">ammount</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">push</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">);
}
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">ArrayBefore</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">.length; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">sum </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">[</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">];
}
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">ArrayAfter</span><span style="color:#c0c5ce;">&quot;);
performance.</span><span style="color:#8fa1b3;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array.for</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">ArrayBefore</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">ArrayAfter</span><span style="color:#c0c5ce;">&quot;);

</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">ammount</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">s</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">);
}
</span><span style="color:#ebcb8b;">console</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">sum</span><span style="color:#c0c5ce;">);
</span><span style="color:#bf616a;">sum </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">SetBefore</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">item </span><span style="color:#c0c5ce;">of </span><span style="color:#bf616a;">s</span><span style="color:#c0c5ce;">) { </span><span style="color:#65737e;">// &lt;- here
	</span><span style="color:#bf616a;">sum </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">item</span><span style="color:#c0c5ce;">;
}
performance.</span><span style="color:#8fa1b3;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">SetAfter</span><span style="color:#c0c5ce;">&quot;);
performance.</span><span style="color:#8fa1b3;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set.for</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">SetBefore</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">SetAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">arrayTime </span><span style="color:#c0c5ce;">= performance.</span><span style="color:#8fa1b3;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array.for</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].</span><span style="color:#bf616a;">duration</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">setTime </span><span style="color:#c0c5ce;">= performance.</span><span style="color:#8fa1b3;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set.for</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].</span><span style="color:#bf616a;">duration</span><span style="color:#c0c5ce;">;
</span><span style="color:#ebcb8b;">console</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">sum</span><span style="color:#c0c5ce;">);
</span><span style="color:#ebcb8b;">console</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(`</span><span style="color:#a3be8c;">Array.for in ${</span><span style="color:#bf616a;">arrayTime</span><span style="color:#a3be8c;">}ms; Set.for in ${</span><span style="color:#bf616a;">setTime</span><span style="color:#a3be8c;">}ms;</span><span style="color:#c0c5ce;">`);
</span><span style="color:#65737e;">// Array.for in 4.44999999999709ms; Set.for in 9.239999999997963ms;
</span></code></pre>
<p>No surprises here. Array sequential values are faster to iterate than Set values (which iterates in insertion order).</p>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#65737e;">// ammount = 100000;
// Array.for in 4.44999999999709ms; Set.for in 9.239999999997963ms;
// ammount = 1000000;
// Array.for in 9.044999999998254ms; Set.for in 55.14499999998952ms;
// ammount = 10000000;
// Array.for in 74.47000000000116ms; Set.for in 180.13999999999942ms;
</span></code></pre>
<p>Arrays are faster for sequential iteration of lots of data.
Converting the Set to an Array is not going to help here because <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from"><code>Array.from</code></a> iterates through the argument to perform the convertion.</p>
<p>Just deal with it :)</p>
<h2 id="set-operations">Set operations</h2>
<p><img src="/images/paulo_coding.jpg" alt="A pic I took more than a decade ago. Paulo, one of the best hackers I have met. Nikon FM2 50mm1.2f, Kodak E100G film, double exposure." /></p>
<p>We saw that Set construction and presence checking are extremely fast operations when compared to their Array counterparts. With this in mind the set operations can be easily and naively done.</p>
<h3 id="union">Union</h3>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#b48ead;">const </span><span style="color:#bf616a;">union </span><span style="color:#c0c5ce;">= new Set([...</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">, ...</span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">]);
</span></code></pre>
<p>Creates a new set with the <em>unique</em> values on set1 and set2 (no repeated values). If you don't care about uniqueness then just use Arrays and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/concat"><code>concat()</code></a> them.</p>
<h3 id="difference">Difference</h3>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#b48ead;">const </span><span style="color:#bf616a;">diff </span><span style="color:#c0c5ce;">= new Set([...</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">].</span><span style="color:#8fa1b3;">filter</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">x </span><span style="color:#b48ead;">=&gt; </span><span style="color:#c0c5ce;">!</span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">has</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">)));
</span></code></pre><h3 id="intersection">Intersection</h3>
<pre style="background-color:#2b303b;">
<code class="language-js" data-lang="js"><span style="color:#b48ead;">const </span><span style="color:#bf616a;">intersected </span><span style="color:#c0c5ce;">= new Set([...</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">].</span><span style="color:#8fa1b3;">filter</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">x </span><span style="color:#b48ead;">=&gt; </span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">.</span><span style="color:#96b5b4;">has</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">)));
</span></code></pre>
<p>Simple as long as you remember that for objects they work with references instead of values.</p>
<h2 id="conclusion">Conclusion</h2>
<ul>
<li>Use Set() when unique values matter</li>
<li>Set.has() is much faster than Array.indexOf()</li>
<li>Array.push() is much faster than Set.add()</li>
<li>Arrays are faster to iterate sequentially</li>
<li>Union, Difference, Intersection are easy to implement with Set</li>
</ul>
<p>Set's are a big part of my project <a href="https://gridgenerator.com">Grid Generator</a>. Keeping these small concepts close to the heart can help you leverage Sets to achieve very good performance even in mobile devices.</p>
<p>I hope this post was valuable in any way to you. If you are interested <a href="https://hugodaniel.com/posts/mastering-console-log/">here is my take on console.log()</a> and also a <a href="https://hugodaniel.com/posts/in-loving-memory-of-immutable/">look into Immutable</a>.</p>

	</article>
	<hr>
	<footer>
		<nav>
			<a target="_blank" href="https://github.com/HugoDaniel" rel="external nofollow">GitHub</a>
			<a target="_blank" href="https://twitter.com/mr_hugo" rel="external nofollow">Twitter</a>
			<a target="_blank" href="https://www.linkedin.com/in/mrhugogomes/" rel="external nofollow">LinkedIN</a>
			<a href="mailto:hello@hugodaniel.com">e-mail</a>
		</nav>
	</footer>
</main>


	</body>
</html>
