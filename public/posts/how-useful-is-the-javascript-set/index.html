<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
			<meta name="description" content="Working, playing and measuring the JavaScript Set data structure">
		
		<link rel="stylesheet" href="https:&#x2F;&#x2F;hugodaniel.com&#x2F;css&#x2F;base.css">
		
			<link rel="alternate" type="application/rss+xml" title="RSS" href="https:&#x2F;&#x2F;hugodaniel.com&#x2F;rss.xml">
		
		
		
		<meta name="twitter:card" content="summary">
		<meta name="twitter:site" content="@mr_hugo">
		<meta name="twitter:creator" content="@mr_hugo">
		
			<title>How useful is the JavaScript Set</title>
			<meta name="twitter:title" content="How useful is the JavaScript Set">
			<meta property="og:title" content="How useful is the JavaScript Set">
			<meta property="og:type" content="article" >
		
		
			<meta name="twitter:description" content="Working, playing and measuring the JavaScript Set data structure">
			<meta property="og:description" content="Working, playing and measuring the JavaScript Set data structure">
		
		
			<meta property="og:article:published_time" content="2017-10-25">
		
		<meta property="og:url" content="https:&#x2F;&#x2F;hugodaniel.com&#x2F;posts&#x2F;how-useful-is-the-javascript-set&#x2F;">
		
		
		
		<!-- Matomo -->
		<script type="text/javascript">
			var _paq = window._paq = window._paq || [];
			/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
			_paq.push(['trackPageView']);
			_paq.push(['enableLinkTracking']);
			(function() {
				var u="//vistas.hugodaniel.pt/";
				_paq.push(['setTrackerUrl', u+'matomo.php']);
				_paq.push(['setSiteId', '2']);
				var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
				g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
			})();
		</script>
		<noscript><p><img src="//vistas.hugodaniel.pt/matomo.php?idsite=2&amp;rec=1" style="border:0;" alt="" /></p></noscript>
		<!-- End Matomo Code -->
	</head>
	<body>
		
<main role="main"> 
	<article>
		<header>
			<h1> How useful is the JavaScript Set </h1>
			<p> Working, playing and measuring the JavaScript Set data structure </p>
			<nav>
				<time datetime="2017-10-25">25-Oct-2017</time>
				<span>
					<a id="back" href="/">About me</a>
					<a target="_blank" href="http://www.twitter.com/mr_hugo" rel="external nofollow">@mr_hugo</a>
					<a href="/posts">All posts</a>
				</span>
			</nav>
		</header>
		<p>In most languages Set's have a clear strong use case: fast union, intersection and difference operations; unfortunately in JavaScript these operations are not readily defined so as an exercise I am going to raise some questions and try to answer them in this post.</p>
<p>All code is run on Firefox Developer Edition 57.0b11 (64-bit) in macOS.</p>
<h2 id="initialization">Initialization</h2>
<p>Most of this post will be used to compare <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">Set()</a> with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">Array()</a> for some common operations. To initialize a Set() I will be constructing it with an Array.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">const </span><span style="color:#bf616a;">set1 </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Set</span><span style="color:#c0c5ce;">([</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">3</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">,</span><span style="color:#d08770;">6</span><span style="color:#c0c5ce;">]);

</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">has</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">// true

</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">;
</span><span style="color:#65737e;">// Set [ 1, 2, 3, 4, 5, 6 ]
</span></code></pre><h2 id="uniqueness">Uniqueness</h2>
<p>Without the common set operations defined the JavaScript Set() can be seen as a glorified container that only stores unique elements. When you put a repeated element it actually replaces the existing one.</p>
<p>This is quite useful for primitive values.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">);
</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">);
</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">);
</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">;
</span><span style="color:#65737e;">// Set [ 1, 2, 3, 4, 5, 6 ]
</span></code></pre>
<p>Unlike Arrays the value will not be repeated when you add it to a Set.</p>
<p>For object values this is not that simple as Set uses references for those values;</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">const </span><span style="color:#bf616a;">set2 </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Set</span><span style="color:#c0c5ce;">([{ value: </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">}, { value: </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">}]);
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">obj1 </span><span style="color:#c0c5ce;">= { value: </span><span style="color:#d08770;">2 </span><span style="color:#c0c5ce;">};
</span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">obj1</span><span style="color:#c0c5ce;">);
</span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">;
</span><span style="color:#65737e;">// Set [{ value: 1}, { value: 2}, { value: 2 }]
</span></code></pre>
<p>The reference is used as the key in the Set, if we change <code>obj1.value</code> above to something else and add it to the Set, JavaScript will see it as a repeated element and replace the existing reference in the Set.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#bf616a;">obj1</span><span style="color:#c0c5ce;">.value = &quot;</span><span style="color:#a3be8c;">foo</span><span style="color:#c0c5ce;">&quot;;
</span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">obj1</span><span style="color:#c0c5ce;">); </span><span style="color:#65737e;">// obj1 is already in the set
</span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">;
</span><span style="color:#65737e;">// Set [{ value: 1}, { value: 2}, { value: &quot;foo&quot; }]
</span></code></pre>
<p>Now just to compare with Arrays, here is a naive implementation to create an array with n values and then filter the unique values in it.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">const </span><span style="color:#bf616a;">n </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">100000</span><span style="color:#c0c5ce;">;
</span><span style="color:#65737e;">// create an array with &#39;n&#39; random numbers:
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">initialArray </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Array</span><span style="color:#c0c5ce;">();
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">number </span><span style="color:#c0c5ce;">= Math.</span><span style="color:#96b5b4;">round</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">random</span><span style="color:#c0c5ce;">()*</span><span style="color:#bf616a;">n</span><span style="color:#c0c5ce;">);
	</span><span style="color:#bf616a;">initialArray</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">push</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">number</span><span style="color:#c0c5ce;">);
}
</span><span style="color:#65737e;">// naively filter the unique values into a new array
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">uniqueArray </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Array</span><span style="color:#c0c5ce;">();
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">UniqueArrayBefore</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">initialArray</span><span style="color:#c0c5ce;">.length; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">value </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">initialArray</span><span style="color:#c0c5ce;">[</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">];
	</span><span style="color:#b48ead;">if </span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">uniqueArray</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">indexOf</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">value</span><span style="color:#c0c5ce;">) === -</span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">) {
		</span><span style="color:#bf616a;">uniqueArray</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">push</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">value</span><span style="color:#c0c5ce;">);
	}
}
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">UniqueArrayAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">uniqueArray</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">UniqueArrayBefore</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">UniqueArrayAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">arrayTotalTime </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">uniqueArray</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].duration;
console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">arrayTotalTime</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">uniqueArray</span><span style="color:#c0c5ce;">.length);
</span><span style="color:#65737e;">// 171.08500000000004 63235
</span></code></pre>
<p>It takes 171 milliseconds to filter ~64k unique values in a 100k elments array. Not bad.</p>
<p>Now lets compare this naive implementation to just using Set():</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">UniqueSetBefore</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">uniqueSet </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Set</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">initialArray</span><span style="color:#c0c5ce;">); </span><span style="color:#65737e;">// easy!
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">UniqueSetAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">uniqueSet</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">UniqueSetBefore</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">UniqueSetAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">setTotalTime </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">uniqueSet</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].duration;
console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">setTotalTime</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">uniqueSet</span><span style="color:#c0c5ce;">.size);
</span><span style="color:#65737e;">// 0.8699999999998909 63235
</span></code></pre>
<p>That is FAST! ~0.9ms with the same initial 100k array. The good part is that Set does not get worse with the number of elements in it.</p>
<p>This is basic JS and the killer feature of Set()'s. Use them when you need a container of unique elements and/or to filter unique elements in any iterable container.</p>
<h2 id="presence">Presence</h2>
<p>Checking if an element is present is also easy in a Set and arguably an operation quite common for containers like these.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">has</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">5</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">// true
</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">has</span><span style="color:#c0c5ce;">(</span><span style="color:#d08770;">1337</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">// false
</span></code></pre>
<p>Arrays also have a presence function called <code>indexOf</code>: it returns the index of the element or -1 if it is not present.</p>
<p>To compare <code>Array.indexOf()</code> to <code>Set.has()</code> here is a quick test that runs 10000 indexOf's (in array) and has's (in Set) for an Array and Set of 100 elements:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">const </span><span style="color:#bf616a;">size </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">100</span><span style="color:#c0c5ce;">; </span><span style="color:#65737e;">// the Array and Set size
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">a </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Array</span><span style="color:#c0c5ce;">();
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">push</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">round</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">random</span><span style="color:#c0c5ce;">()*</span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">));
}
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">s </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Set</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">);

</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">ops </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">10000</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">indexAll </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array Before</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">ops</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">indexAll </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">indexOf</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">round</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">random</span><span style="color:#c0c5ce;">()*</span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">));
	</span><span style="color:#65737e;">// ^ just to do some operation
</span><span style="color:#c0c5ce;">}
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array After</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array.indexOf()</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">Array Before</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">Array After</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">arrayTotalTime </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array.indexOf()</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].duration;

</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">setValue </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">false</span><span style="color:#c0c5ce;">;
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set Before</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">ops</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">setValue </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">s</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">has</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">round</span><span style="color:#c0c5ce;">(Math.</span><span style="color:#96b5b4;">random</span><span style="color:#c0c5ce;">()*</span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">));
	</span><span style="color:#65737e;">// ^ same as above just to do some operation
</span><span style="color:#c0c5ce;">}
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set After</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set.has()</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">Set Before</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">Set After</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">setTotalTime </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set.has()</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].duration;

console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">setValue</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">indexAll</span><span style="color:#c0c5ce;">);
console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">SET: </span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#bf616a;">setTotalTime</span><span style="color:#c0c5ce;">, &quot;</span><span style="color:#a3be8c;">ARRAY: </span><span style="color:#c0c5ce;">&quot;, </span><span style="color:#bf616a;">arrayTotalTime</span><span style="color:#c0c5ce;">);
</span><span style="color:#65737e;">// SET:  17.68499999999767 ARRAY:  20.924999999995634
</span></code></pre>
<p>A slight difference. Multiple executions give values that are coherent with these (not an outlier).
<code>Set.has()</code> is faster than the <code>Array.indexOf()</code> even for small Arrays.</p>
<p>The difference of execution just gets bigger as the size of the containers increase.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#65737e;">// size = 1000;
// SET:  21.014999999999418 ARRAY:  54.00500000000102
// size = 10000;
// SET:  17.44499999999971 ARRAY:  398.505000000001
// size = 100000;
// SET:  19.770000000004075 ARRAY:  3779.524999999994
</span></code></pre>
<p><code>Set.has()</code> execution time doesn't seem to differ with the set size. The JS spec tells us why:</p>
<p><em>&quot;Set objects must be implemented using either hash tables or other mechanisms that, on average, provide access times that are sublinear on the number of elements in the collection.&quot;</em> <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-set-objects">[*]</a></p>
<p>It does not even bother heating your CPU as my browser probably implements this to be O(shiznit(n)) for a large enough n (I will not go into detail here so I will leave the measurement as an exercise for you as it is always important/necessary to measure Big-O behaviours).</p>
<h2 id="insertion-speed">Insertion speed</h2>
<p>Right now Sets seem really cool, how about we check how fast is the add() method in comparison to an array push(), like we did in the <a href="https://hugodaniel.com/posts/in-loving-memory-of-immutable/">Immutable.List vs Array article</a> ?</p>
<p>The code is simple, two loops, one for Array.push() and another for Set.add().</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">const </span><span style="color:#bf616a;">s </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Set</span><span style="color:#c0c5ce;">();
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">a </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Array</span><span style="color:#c0c5ce;">();
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">ammount </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">100000</span><span style="color:#c0c5ce;">;
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">ArrayBefore</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">ammount</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">push</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">);
}
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">ArrayAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array.push</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">ArrayBefore</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">ArrayAfter</span><span style="color:#c0c5ce;">&quot;);

</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">SetBefore</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">ammount</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">s</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">);
}
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">SetAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set.add</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">SetBefore</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">SetAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">arrayTime </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array.push</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].duration;
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">setTime </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set.add</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].duration;
console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(`</span><span style="color:#a3be8c;">Array.push in </span><span style="color:#c0c5ce;">${</span><span style="color:#bf616a;">arrayTime</span><span style="color:#c0c5ce;">}</span><span style="color:#a3be8c;">ms; Set.add in </span><span style="color:#c0c5ce;">${</span><span style="color:#bf616a;">setTime</span><span style="color:#c0c5ce;">}</span><span style="color:#a3be8c;">ms;</span><span style="color:#c0c5ce;">`);
</span><span style="color:#65737e;">// Array.push in 4.054999999993015ms; Set.add in 20.915000000037253ms;
</span></code></pre>
<p>Ah! Arrays are much faster (5x) in insertion than Sets. If you are an experience developer this is not really surprising at all, but still it is nice to check.
Be aware that insertion speed grows linearly in Arrays and non-linearly in Sets:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#65737e;">// ammount = 100000;
// Array.push in 4.054999999993015ms; Set.add in 20.915000000037253ms;
// ammount = 1000000;
// Array.push in 17.175000000046566ms; Set.add in 417.03999999992084ms;
// ^ ~4x more than prev.               ^ ~20x more than prev.
// ammount = 10000000;
// Array.push in 349.8299999999581ms; Set.add in 3902.625ms;
// ^ ~20x more than prev.             ^ ~10x more than prev.
</span></code></pre>
<p>We could continue, but JavaScript numbers are <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">64 bit double precision floating point values</a>. Which means that for integer values they will use 52bits of storage for the significand. Which in turn means that for the next ammount (100000000) I would need 650MB of memory just to store the numbers + the overhead of the Array and Set data structures.</p>
<p>Another exercise for the reader :D</p>
<p>If you are doing a cheap fast logger, then Array is a better choice than Set since it inserts much faster. Set add() is probably implemented to have a better <a href="https://en.wikipedia.org/wiki/Big_O_notation">O(some BS here)</a> than the Array push() and it will likely not be much slower than 10x the previous running order. But their measured absolute value is way slower and this is what really matters, always measure your code if you care about performance because overhead can creep in the most unexpected places (I am not sure if this is the case, but still...).</p>
<h2 id="iteration-speed">Iteration speed</h2>
<p>If you are wondering how Set performs in the need to iterate through its elements, wonder no further.</p>
<p>Again the two cycles, this time using for..of to go through the Set items.</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">const </span><span style="color:#bf616a;">s </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Set</span><span style="color:#c0c5ce;">();
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">a </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Array</span><span style="color:#c0c5ce;">();
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">ammount </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">100000</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">sum </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">ammount</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">push</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">);
}
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">ArrayBefore</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">.length; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">sum </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">a</span><span style="color:#c0c5ce;">[</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">];
}
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">ArrayAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array.for</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">ArrayBefore</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">ArrayAfter</span><span style="color:#c0c5ce;">&quot;);

</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i </span><span style="color:#c0c5ce;">&lt; </span><span style="color:#bf616a;">ammount</span><span style="color:#c0c5ce;">; </span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">++) {
	</span><span style="color:#bf616a;">s</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">add</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">i</span><span style="color:#c0c5ce;">);
}
console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">sum</span><span style="color:#c0c5ce;">);
</span><span style="color:#bf616a;">sum </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">;
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">SetBefore</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">for </span><span style="color:#c0c5ce;">(</span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">item </span><span style="color:#c0c5ce;">of </span><span style="color:#bf616a;">s</span><span style="color:#c0c5ce;">) { </span><span style="color:#65737e;">// &lt;- here
	</span><span style="color:#bf616a;">sum </span><span style="color:#c0c5ce;">+= </span><span style="color:#bf616a;">item</span><span style="color:#c0c5ce;">;
}
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">mark</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">SetAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">measure</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set.for</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">SetBefore</span><span style="color:#c0c5ce;">&quot;, &quot;</span><span style="color:#a3be8c;">SetAfter</span><span style="color:#c0c5ce;">&quot;);
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">arrayTime </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Array.for</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].duration;
</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">setTime </span><span style="color:#c0c5ce;">= </span><span style="color:#bf616a;">performance</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">getEntriesByName</span><span style="color:#c0c5ce;">(&quot;</span><span style="color:#a3be8c;">Set.for</span><span style="color:#c0c5ce;">&quot;)[</span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">].duration;
console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">sum</span><span style="color:#c0c5ce;">);
console.</span><span style="color:#96b5b4;">log</span><span style="color:#c0c5ce;">(`</span><span style="color:#a3be8c;">Array.for in </span><span style="color:#c0c5ce;">${</span><span style="color:#bf616a;">arrayTime</span><span style="color:#c0c5ce;">}</span><span style="color:#a3be8c;">ms; Set.for in </span><span style="color:#c0c5ce;">${</span><span style="color:#bf616a;">setTime</span><span style="color:#c0c5ce;">}</span><span style="color:#a3be8c;">ms;</span><span style="color:#c0c5ce;">`);
</span><span style="color:#65737e;">// Array.for in 4.44999999999709ms; Set.for in 9.239999999997963ms;
</span></code></pre>
<p>No surprises here. Array sequential values are faster to iterate than Set values (which iterates in insertion order).</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#65737e;">// ammount = 100000;
// Array.for in 4.44999999999709ms; Set.for in 9.239999999997963ms;
// ammount = 1000000;
// Array.for in 9.044999999998254ms; Set.for in 55.14499999998952ms;
// ammount = 10000000;
// Array.for in 74.47000000000116ms; Set.for in 180.13999999999942ms;
</span></code></pre>
<p>Arrays are faster for sequential iteration of lots of data.
Converting the Set to an Array is not going to help here because <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from"><code>Array.from</code></a> iterates through the argument to perform the convertion.</p>
<p>Just deal with it :)</p>
<h2 id="set-operations">Set operations</h2>
<p><img src="/images/paulo_coding.jpg" alt="A pic I took more than a decade ago. Paulo, one of the best hackers I have met. Nikon FM2 50mm1.2f, Kodak E100G film, double exposure." /></p>
<p>We saw that Set construction and presence checking are extremely fast operations when compared to their Array counterparts. With this in mind the set operations can be easily and naively done.</p>
<h3 id="union">Union</h3>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">const </span><span style="color:#bf616a;">union </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Set</span><span style="color:#c0c5ce;">([...</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">, ...</span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">]);
</span></code></pre>
<p>Creates a new set with the <em>unique</em> values on set1 and set2 (no repeated values). If you don't care about uniqueness then just use Arrays and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/concat"><code>concat()</code></a> them.</p>
<h3 id="difference">Difference</h3>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">const </span><span style="color:#bf616a;">diff </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Set</span><span style="color:#c0c5ce;">([...</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">].</span><span style="color:#bf616a;">filter</span><span style="color:#c0c5ce;">(x </span><span style="color:#b48ead;">=&gt; </span><span style="color:#c0c5ce;">!</span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">has</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">)));
</span></code></pre><h3 id="intersection">Intersection</h3>
<pre style="background-color:#2b303b;">
<code><span style="color:#b48ead;">const </span><span style="color:#bf616a;">intersected </span><span style="color:#c0c5ce;">= new </span><span style="color:#ebcb8b;">Set</span><span style="color:#c0c5ce;">([...</span><span style="color:#bf616a;">set1</span><span style="color:#c0c5ce;">].</span><span style="color:#bf616a;">filter</span><span style="color:#c0c5ce;">(x </span><span style="color:#b48ead;">=&gt; </span><span style="color:#bf616a;">set2</span><span style="color:#c0c5ce;">.</span><span style="color:#bf616a;">has</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">x</span><span style="color:#c0c5ce;">)));
</span></code></pre>
<p>Simple as long as you remember that for objects they work with references instead of values.</p>
<h2 id="conclusion">Conclusion</h2>
<ul>
<li>Use Set() when unique values matter</li>
<li>Set.has() is much faster than Array.indexOf()</li>
<li>Array.push() is much faster than Set.add()</li>
<li>Arrays are faster to iterate sequentially</li>
<li>Union, Difference, Intersection are easy to implement with Set</li>
</ul>
<p>Set's are a big part of my project <a href="https://gridgenerator.com">Grid Generator</a>. Keeping these small concepts close to the heart can help you leverage Sets to achieve very good performance even in mobile devices.</p>
<p>I hope this post was valuable in any way to you. If you are interested <a href="https://hugodaniel.com/posts/mastering-console-log/">here is my take on console.log()</a> and also a <a href="https://hugodaniel.com/posts/in-loving-memory-of-immutable/">look into Immutable</a>.</p>

	</article>
	<hr>
	<footer>
		<nav>
			<a target="_blank" href="https://github.com/HugoDaniel" rel="external nofollow">GitHub</a>
			<a target="_blank" href="https://twitter.com/mr_hugo" rel="external nofollow">Twitter</a>
			<a target="_blank" href="https://www.linkedin.com/in/mrhugogomes/" rel="external nofollow">LinkedIN</a>
			<a href="mailto:hello@hugodaniel.com">e-mail</a>
		</nav>
	</footer>
</main>


	<!--
		<footer>
			<div>
				<p>Latest project</p>
				<a href="https://gridgenerator.com" target="_blank">Grid Generator</a>
			</div>
			<nav>
				<a target="_blank" href="https://twitter.com/mr_hugo">
					<img src="https:&#x2F;&#x2F;hugodaniel.com&#x2F;images&#x2F;twitter.svg" alt="Twitter" />
				</a>
				<a target="_blank" href="https://github.com/HugoDaniel">
					<img src="https:&#x2F;&#x2F;hugodaniel.com&#x2F;images&#x2F;github.svg" alt="GitHub" />
				</a>
				<a target="_blank" href="https://www.linkedin.com/in/mrhugogomes/">
					<img src="https:&#x2F;&#x2F;hugodaniel.com&#x2F;images&#x2F;linkedin.svg" alt="LinkedIn" />
				</a>
			</nav>
			<div>
				<p>Liked what you read ?</p>
				<a href="mailto:mail@hugodaniel.pt">Say hello :)!</a>
			</div>
		</footer>
		<script>
			console.log({
  "config": {
    "base_url": "https://hugodaniel.com",
    "theme": null,
    "title": null,
    "description": null,
    "default_language": "en",
    "languages": [],
    "translations": {},
    "highlight_code": true,
    "highlight_theme": "base16-ocean-dark",
    "generate_feed": true,
    "feed_limit": null,
    "feed_filename": "atom.xml",
    "hard_link_static": false,
    "taxonomies": [],
    "compile_sass": false,
    "minify_html": false,
    "build_search_index": true,
    "ignored_content": [],
    "extra_syntaxes": [],
    "link_checker": {
      "skip_prefixes": [],
      "skip_anchor_prefixes": []
    },
    "slugify": {
      "paths": "on",
      "taxonomies": "on",
      "anchors": "on"
    },
    "search": {
      "include_title": true,
      "include_content": true,
      "truncate_content_length": null,
      "include_description": false
    },
    "extra": {}
  },
  "current_path": "/posts/how-useful-is-the-javascript-set/",
  "current_url": "https://hugodaniel.com/posts/how-useful-is-the-javascript-set/",
  "lang": "en",
  "page": {
    "relative_path": "posts/2017-10-26-how-useful-is-the-javascript-set.md",
    "content": "<p>In most languages Set's have a clear strong use case: fast union, intersection and difference operations; unfortunately in JavaScript these operations are not readily defined so as an exercise I am going to raise some questions and try to answer them in this post.</p>\n<p>All code is run on Firefox Developer Edition 57.0b11 (64-bit) in macOS.</p>\n<h2 id=\"initialization\">Initialization</h2>\n<p>Most of this post will be used to compare <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set\">Set()</a> with <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array\">Array()</a> for some common operations. To initialize a Set() I will be constructing it with an Array.</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">set1 </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Set</span><span style=\"color:#c0c5ce;\">([</span><span style=\"color:#d08770;\">1</span><span style=\"color:#c0c5ce;\">,</span><span style=\"color:#d08770;\">2</span><span style=\"color:#c0c5ce;\">,</span><span style=\"color:#d08770;\">3</span><span style=\"color:#c0c5ce;\">,</span><span style=\"color:#d08770;\">4</span><span style=\"color:#c0c5ce;\">,</span><span style=\"color:#d08770;\">5</span><span style=\"color:#c0c5ce;\">,</span><span style=\"color:#d08770;\">6</span><span style=\"color:#c0c5ce;\">]);\n\n</span><span style=\"color:#bf616a;\">set1</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">has</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#d08770;\">5</span><span style=\"color:#c0c5ce;\">);\n</span><span style=\"color:#65737e;\">// true\n\n</span><span style=\"color:#bf616a;\">set1</span><span style=\"color:#c0c5ce;\">;\n</span><span style=\"color:#65737e;\">// Set [ 1, 2, 3, 4, 5, 6 ]\n</span></code></pre><h2 id=\"uniqueness\">Uniqueness</h2>\n<p>Without the common set operations defined the JavaScript Set() can be seen as a glorified container that only stores unique elements. When you put a repeated element it actually replaces the existing one.</p>\n<p>This is quite useful for primitive values.</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#bf616a;\">set1</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">add</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#d08770;\">5</span><span style=\"color:#c0c5ce;\">);\n</span><span style=\"color:#bf616a;\">set1</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">add</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#d08770;\">5</span><span style=\"color:#c0c5ce;\">);\n</span><span style=\"color:#bf616a;\">set1</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">add</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#d08770;\">5</span><span style=\"color:#c0c5ce;\">);\n</span><span style=\"color:#bf616a;\">set1</span><span style=\"color:#c0c5ce;\">;\n</span><span style=\"color:#65737e;\">// Set [ 1, 2, 3, 4, 5, 6 ]\n</span></code></pre>\n<p>Unlike Arrays the value will not be repeated when you add it to a Set.</p>\n<p>For object values this is not that simple as Set uses references for those values;</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">set2 </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Set</span><span style=\"color:#c0c5ce;\">([{ value: </span><span style=\"color:#d08770;\">1</span><span style=\"color:#c0c5ce;\">}, { value: </span><span style=\"color:#d08770;\">2</span><span style=\"color:#c0c5ce;\">}]);\n</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">obj1 </span><span style=\"color:#c0c5ce;\">= { value: </span><span style=\"color:#d08770;\">2 </span><span style=\"color:#c0c5ce;\">};\n</span><span style=\"color:#bf616a;\">set2</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">add</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">obj1</span><span style=\"color:#c0c5ce;\">);\n</span><span style=\"color:#bf616a;\">set2</span><span style=\"color:#c0c5ce;\">;\n</span><span style=\"color:#65737e;\">// Set [{ value: 1}, { value: 2}, { value: 2 }]\n</span></code></pre>\n<p>The reference is used as the key in the Set, if we change <code>obj1.value</code> above to something else and add it to the Set, JavaScript will see it as a repeated element and replace the existing reference in the Set.</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#bf616a;\">obj1</span><span style=\"color:#c0c5ce;\">.value = &quot;</span><span style=\"color:#a3be8c;\">foo</span><span style=\"color:#c0c5ce;\">&quot;;\n</span><span style=\"color:#bf616a;\">set2</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">add</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">obj1</span><span style=\"color:#c0c5ce;\">); </span><span style=\"color:#65737e;\">// obj1 is already in the set\n</span><span style=\"color:#bf616a;\">set2</span><span style=\"color:#c0c5ce;\">;\n</span><span style=\"color:#65737e;\">// Set [{ value: 1}, { value: 2}, { value: &quot;foo&quot; }]\n</span></code></pre>\n<p>Now just to compare with Arrays, here is a naive implementation to create an array with n values and then filter the unique values in it.</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">n </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">100000</span><span style=\"color:#c0c5ce;\">;\n</span><span style=\"color:#65737e;\">// create an array with &#39;n&#39; random numbers:\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">initialArray </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Array</span><span style=\"color:#c0c5ce;\">();\n</span><span style=\"color:#b48ead;\">for </span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">&lt; </span><span style=\"color:#bf616a;\">n</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">++) {\n\t</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">number </span><span style=\"color:#c0c5ce;\">= Math.</span><span style=\"color:#96b5b4;\">round</span><span style=\"color:#c0c5ce;\">(Math.</span><span style=\"color:#96b5b4;\">random</span><span style=\"color:#c0c5ce;\">()*</span><span style=\"color:#bf616a;\">n</span><span style=\"color:#c0c5ce;\">);\n\t</span><span style=\"color:#bf616a;\">initialArray</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">push</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">number</span><span style=\"color:#c0c5ce;\">);\n}\n</span><span style=\"color:#65737e;\">// naively filter the unique values into a new array\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">uniqueArray </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Array</span><span style=\"color:#c0c5ce;\">();\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">UniqueArrayBefore</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">for </span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">&lt; </span><span style=\"color:#bf616a;\">initialArray</span><span style=\"color:#c0c5ce;\">.length; </span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">++) {\n\t</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">value </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#bf616a;\">initialArray</span><span style=\"color:#c0c5ce;\">[</span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">];\n\t</span><span style=\"color:#b48ead;\">if </span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">uniqueArray</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">indexOf</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">value</span><span style=\"color:#c0c5ce;\">) === -</span><span style=\"color:#d08770;\">1</span><span style=\"color:#c0c5ce;\">) {\n\t\t</span><span style=\"color:#bf616a;\">uniqueArray</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">push</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">value</span><span style=\"color:#c0c5ce;\">);\n\t}\n}\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">UniqueArrayAfter</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">measure</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">uniqueArray</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">UniqueArrayBefore</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">UniqueArrayAfter</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">arrayTotalTime </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">getEntriesByName</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">uniqueArray</span><span style=\"color:#c0c5ce;\">&quot;)[</span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">].duration;\nconsole.</span><span style=\"color:#96b5b4;\">log</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">arrayTotalTime</span><span style=\"color:#c0c5ce;\">, </span><span style=\"color:#bf616a;\">uniqueArray</span><span style=\"color:#c0c5ce;\">.length);\n</span><span style=\"color:#65737e;\">// 171.08500000000004 63235\n</span></code></pre>\n<p>It takes 171 milliseconds to filter ~64k unique values in a 100k elments array. Not bad.</p>\n<p>Now lets compare this naive implementation to just using Set():</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">UniqueSetBefore</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">uniqueSet </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Set</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">initialArray</span><span style=\"color:#c0c5ce;\">); </span><span style=\"color:#65737e;\">// easy!\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">UniqueSetAfter</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">measure</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">uniqueSet</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">UniqueSetBefore</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">UniqueSetAfter</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">setTotalTime </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">getEntriesByName</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">uniqueSet</span><span style=\"color:#c0c5ce;\">&quot;)[</span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">].duration;\nconsole.</span><span style=\"color:#96b5b4;\">log</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">setTotalTime</span><span style=\"color:#c0c5ce;\">, </span><span style=\"color:#bf616a;\">uniqueSet</span><span style=\"color:#c0c5ce;\">.size);\n</span><span style=\"color:#65737e;\">// 0.8699999999998909 63235\n</span></code></pre>\n<p>That is FAST! ~0.9ms with the same initial 100k array. The good part is that Set does not get worse with the number of elements in it.</p>\n<p>This is basic JS and the killer feature of Set()'s. Use them when you need a container of unique elements and/or to filter unique elements in any iterable container.</p>\n<h2 id=\"presence\">Presence</h2>\n<p>Checking if an element is present is also easy in a Set and arguably an operation quite common for containers like these.</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#bf616a;\">set1</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">has</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#d08770;\">5</span><span style=\"color:#c0c5ce;\">);\n</span><span style=\"color:#65737e;\">// true\n</span><span style=\"color:#bf616a;\">set1</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">has</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#d08770;\">1337</span><span style=\"color:#c0c5ce;\">);\n</span><span style=\"color:#65737e;\">// false\n</span></code></pre>\n<p>Arrays also have a presence function called <code>indexOf</code>: it returns the index of the element or -1 if it is not present.</p>\n<p>To compare <code>Array.indexOf()</code> to <code>Set.has()</code> here is a quick test that runs 10000 indexOf's (in array) and has's (in Set) for an Array and Set of 100 elements:</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">size </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">100</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#65737e;\">// the Array and Set size\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">a </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Array</span><span style=\"color:#c0c5ce;\">();\n</span><span style=\"color:#b48ead;\">for </span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">&lt; </span><span style=\"color:#bf616a;\">size</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">++) {\n\t</span><span style=\"color:#bf616a;\">a</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">push</span><span style=\"color:#c0c5ce;\">(Math.</span><span style=\"color:#96b5b4;\">round</span><span style=\"color:#c0c5ce;\">(Math.</span><span style=\"color:#96b5b4;\">random</span><span style=\"color:#c0c5ce;\">()*</span><span style=\"color:#bf616a;\">size</span><span style=\"color:#c0c5ce;\">));\n}\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">s </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Set</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">a</span><span style=\"color:#c0c5ce;\">);\n\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">ops </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">10000</span><span style=\"color:#c0c5ce;\">;\n</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">indexAll </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">;\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Array Before</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">for </span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">&lt; </span><span style=\"color:#bf616a;\">ops</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">++) {\n\t</span><span style=\"color:#bf616a;\">indexAll </span><span style=\"color:#c0c5ce;\">+= </span><span style=\"color:#bf616a;\">a</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">indexOf</span><span style=\"color:#c0c5ce;\">(Math.</span><span style=\"color:#96b5b4;\">round</span><span style=\"color:#c0c5ce;\">(Math.</span><span style=\"color:#96b5b4;\">random</span><span style=\"color:#c0c5ce;\">()*</span><span style=\"color:#bf616a;\">size</span><span style=\"color:#c0c5ce;\">));\n\t</span><span style=\"color:#65737e;\">// ^ just to do some operation\n</span><span style=\"color:#c0c5ce;\">}\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Array After</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">measure</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Array.indexOf()</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">Array Before</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">Array After</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">arrayTotalTime </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">getEntriesByName</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Array.indexOf()</span><span style=\"color:#c0c5ce;\">&quot;)[</span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">].duration;\n\n</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">setValue </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">false</span><span style=\"color:#c0c5ce;\">;\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Set Before</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">for </span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">&lt; </span><span style=\"color:#bf616a;\">ops</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">++) {\n\t</span><span style=\"color:#bf616a;\">setValue </span><span style=\"color:#c0c5ce;\">+= </span><span style=\"color:#bf616a;\">s</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">has</span><span style=\"color:#c0c5ce;\">(Math.</span><span style=\"color:#96b5b4;\">round</span><span style=\"color:#c0c5ce;\">(Math.</span><span style=\"color:#96b5b4;\">random</span><span style=\"color:#c0c5ce;\">()*</span><span style=\"color:#bf616a;\">size</span><span style=\"color:#c0c5ce;\">));\n\t</span><span style=\"color:#65737e;\">// ^ same as above just to do some operation\n</span><span style=\"color:#c0c5ce;\">}\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Set After</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">measure</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Set.has()</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">Set Before</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">Set After</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">setTotalTime </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">getEntriesByName</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Set.has()</span><span style=\"color:#c0c5ce;\">&quot;)[</span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">].duration;\n\nconsole.</span><span style=\"color:#96b5b4;\">log</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">setValue</span><span style=\"color:#c0c5ce;\">, </span><span style=\"color:#bf616a;\">indexAll</span><span style=\"color:#c0c5ce;\">);\nconsole.</span><span style=\"color:#96b5b4;\">log</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">SET: </span><span style=\"color:#c0c5ce;\">&quot;, </span><span style=\"color:#bf616a;\">setTotalTime</span><span style=\"color:#c0c5ce;\">, &quot;</span><span style=\"color:#a3be8c;\">ARRAY: </span><span style=\"color:#c0c5ce;\">&quot;, </span><span style=\"color:#bf616a;\">arrayTotalTime</span><span style=\"color:#c0c5ce;\">);\n</span><span style=\"color:#65737e;\">// SET:  17.68499999999767 ARRAY:  20.924999999995634\n</span></code></pre>\n<p>A slight difference. Multiple executions give values that are coherent with these (not an outlier).\n<code>Set.has()</code> is faster than the <code>Array.indexOf()</code> even for small Arrays.</p>\n<p>The difference of execution just gets bigger as the size of the containers increase.</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#65737e;\">// size = 1000;\n// SET:  21.014999999999418 ARRAY:  54.00500000000102\n// size = 10000;\n// SET:  17.44499999999971 ARRAY:  398.505000000001\n// size = 100000;\n// SET:  19.770000000004075 ARRAY:  3779.524999999994\n</span></code></pre>\n<p><code>Set.has()</code> execution time doesn't seem to differ with the set size. The JS spec tells us why:</p>\n<p><em>&quot;Set objects must be implemented using either hash tables or other mechanisms that, on average, provide access times that are sublinear on the number of elements in the collection.&quot;</em> <a href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-set-objects\">[*]</a></p>\n<p>It does not even bother heating your CPU as my browser probably implements this to be O(shiznit(n)) for a large enough n (I will not go into detail here so I will leave the measurement as an exercise for you as it is always important/necessary to measure Big-O behaviours).</p>\n<h2 id=\"insertion-speed\">Insertion speed</h2>\n<p>Right now Sets seem really cool, how about we check how fast is the add() method in comparison to an array push(), like we did in the <a href=\"https://hugodaniel.com/posts/in-loving-memory-of-immutable/\">Immutable.List vs Array article</a> ?</p>\n<p>The code is simple, two loops, one for Array.push() and another for Set.add().</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">s </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Set</span><span style=\"color:#c0c5ce;\">();\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">a </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Array</span><span style=\"color:#c0c5ce;\">();\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">ammount </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">100000</span><span style=\"color:#c0c5ce;\">;\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">ArrayBefore</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">for </span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">&lt; </span><span style=\"color:#bf616a;\">ammount</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">++) {\n\t</span><span style=\"color:#bf616a;\">a</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">push</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">);\n}\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">ArrayAfter</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">measure</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Array.push</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">ArrayBefore</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">ArrayAfter</span><span style=\"color:#c0c5ce;\">&quot;);\n\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">SetBefore</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">for </span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">&lt; </span><span style=\"color:#bf616a;\">ammount</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">++) {\n\t</span><span style=\"color:#bf616a;\">s</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">add</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">);\n}\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">SetAfter</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">measure</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Set.add</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">SetBefore</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">SetAfter</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">arrayTime </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">getEntriesByName</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Array.push</span><span style=\"color:#c0c5ce;\">&quot;)[</span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">].duration;\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">setTime </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">getEntriesByName</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Set.add</span><span style=\"color:#c0c5ce;\">&quot;)[</span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">].duration;\nconsole.</span><span style=\"color:#96b5b4;\">log</span><span style=\"color:#c0c5ce;\">(`</span><span style=\"color:#a3be8c;\">Array.push in </span><span style=\"color:#c0c5ce;\">${</span><span style=\"color:#bf616a;\">arrayTime</span><span style=\"color:#c0c5ce;\">}</span><span style=\"color:#a3be8c;\">ms; Set.add in </span><span style=\"color:#c0c5ce;\">${</span><span style=\"color:#bf616a;\">setTime</span><span style=\"color:#c0c5ce;\">}</span><span style=\"color:#a3be8c;\">ms;</span><span style=\"color:#c0c5ce;\">`);\n</span><span style=\"color:#65737e;\">// Array.push in 4.054999999993015ms; Set.add in 20.915000000037253ms;\n</span></code></pre>\n<p>Ah! Arrays are much faster (5x) in insertion than Sets. If you are an experience developer this is not really surprising at all, but still it is nice to check.\nBe aware that insertion speed grows linearly in Arrays and non-linearly in Sets:</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#65737e;\">// ammount = 100000;\n// Array.push in 4.054999999993015ms; Set.add in 20.915000000037253ms;\n// ammount = 1000000;\n// Array.push in 17.175000000046566ms; Set.add in 417.03999999992084ms;\n// ^ ~4x more than prev.               ^ ~20x more than prev.\n// ammount = 10000000;\n// Array.push in 349.8299999999581ms; Set.add in 3902.625ms;\n// ^ ~20x more than prev.             ^ ~10x more than prev.\n</span></code></pre>\n<p>We could continue, but JavaScript numbers are <a href=\"https://en.wikipedia.org/wiki/Double-precision_floating-point_format\">64 bit double precision floating point values</a>. Which means that for integer values they will use 52bits of storage for the significand. Which in turn means that for the next ammount (100000000) I would need 650MB of memory just to store the numbers + the overhead of the Array and Set data structures.</p>\n<p>Another exercise for the reader :D</p>\n<p>If you are doing a cheap fast logger, then Array is a better choice than Set since it inserts much faster. Set add() is probably implemented to have a better <a href=\"https://en.wikipedia.org/wiki/Big_O_notation\">O(some BS here)</a> than the Array push() and it will likely not be much slower than 10x the previous running order. But their measured absolute value is way slower and this is what really matters, always measure your code if you care about performance because overhead can creep in the most unexpected places (I am not sure if this is the case, but still...).</p>\n<h2 id=\"iteration-speed\">Iteration speed</h2>\n<p>If you are wondering how Set performs in the need to iterate through its elements, wonder no further.</p>\n<p>Again the two cycles, this time using for..of to go through the Set items.</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">s </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Set</span><span style=\"color:#c0c5ce;\">();\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">a </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Array</span><span style=\"color:#c0c5ce;\">();\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">ammount </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">100000</span><span style=\"color:#c0c5ce;\">;\n</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">sum </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">;\n</span><span style=\"color:#b48ead;\">for </span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">&lt; </span><span style=\"color:#bf616a;\">ammount</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">++) {\n\t</span><span style=\"color:#bf616a;\">a</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">push</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">);\n}\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">ArrayBefore</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">for </span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">&lt; </span><span style=\"color:#bf616a;\">a</span><span style=\"color:#c0c5ce;\">.length; </span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">++) {\n\t</span><span style=\"color:#bf616a;\">sum </span><span style=\"color:#c0c5ce;\">+= </span><span style=\"color:#bf616a;\">a</span><span style=\"color:#c0c5ce;\">[</span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">];\n}\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">ArrayAfter</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">measure</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Array.for</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">ArrayBefore</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">ArrayAfter</span><span style=\"color:#c0c5ce;\">&quot;);\n\n</span><span style=\"color:#b48ead;\">for </span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i </span><span style=\"color:#c0c5ce;\">&lt; </span><span style=\"color:#bf616a;\">ammount</span><span style=\"color:#c0c5ce;\">; </span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">++) {\n\t</span><span style=\"color:#bf616a;\">s</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">add</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">i</span><span style=\"color:#c0c5ce;\">);\n}\nconsole.</span><span style=\"color:#96b5b4;\">log</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">sum</span><span style=\"color:#c0c5ce;\">);\n</span><span style=\"color:#bf616a;\">sum </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">;\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">SetBefore</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">for </span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#b48ead;\">let </span><span style=\"color:#bf616a;\">item </span><span style=\"color:#c0c5ce;\">of </span><span style=\"color:#bf616a;\">s</span><span style=\"color:#c0c5ce;\">) { </span><span style=\"color:#65737e;\">// &lt;- here\n\t</span><span style=\"color:#bf616a;\">sum </span><span style=\"color:#c0c5ce;\">+= </span><span style=\"color:#bf616a;\">item</span><span style=\"color:#c0c5ce;\">;\n}\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">mark</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">SetAfter</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">measure</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Set.for</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">SetBefore</span><span style=\"color:#c0c5ce;\">&quot;, &quot;</span><span style=\"color:#a3be8c;\">SetAfter</span><span style=\"color:#c0c5ce;\">&quot;);\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">arrayTime </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">getEntriesByName</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Array.for</span><span style=\"color:#c0c5ce;\">&quot;)[</span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">].duration;\n</span><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">setTime </span><span style=\"color:#c0c5ce;\">= </span><span style=\"color:#bf616a;\">performance</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">getEntriesByName</span><span style=\"color:#c0c5ce;\">(&quot;</span><span style=\"color:#a3be8c;\">Set.for</span><span style=\"color:#c0c5ce;\">&quot;)[</span><span style=\"color:#d08770;\">0</span><span style=\"color:#c0c5ce;\">].duration;\nconsole.</span><span style=\"color:#96b5b4;\">log</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">sum</span><span style=\"color:#c0c5ce;\">);\nconsole.</span><span style=\"color:#96b5b4;\">log</span><span style=\"color:#c0c5ce;\">(`</span><span style=\"color:#a3be8c;\">Array.for in </span><span style=\"color:#c0c5ce;\">${</span><span style=\"color:#bf616a;\">arrayTime</span><span style=\"color:#c0c5ce;\">}</span><span style=\"color:#a3be8c;\">ms; Set.for in </span><span style=\"color:#c0c5ce;\">${</span><span style=\"color:#bf616a;\">setTime</span><span style=\"color:#c0c5ce;\">}</span><span style=\"color:#a3be8c;\">ms;</span><span style=\"color:#c0c5ce;\">`);\n</span><span style=\"color:#65737e;\">// Array.for in 4.44999999999709ms; Set.for in 9.239999999997963ms;\n</span></code></pre>\n<p>No surprises here. Array sequential values are faster to iterate than Set values (which iterates in insertion order).</p>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#65737e;\">// ammount = 100000;\n// Array.for in 4.44999999999709ms; Set.for in 9.239999999997963ms;\n// ammount = 1000000;\n// Array.for in 9.044999999998254ms; Set.for in 55.14499999998952ms;\n// ammount = 10000000;\n// Array.for in 74.47000000000116ms; Set.for in 180.13999999999942ms;\n</span></code></pre>\n<p>Arrays are faster for sequential iteration of lots of data.\nConverting the Set to an Array is not going to help here because <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from\"><code>Array.from</code></a> iterates through the argument to perform the convertion.</p>\n<p>Just deal with it :)</p>\n<h2 id=\"set-operations\">Set operations</h2>\n<p><img src=\"/images/paulo_coding.jpg\" alt=\"A pic I took more than a decade ago. Paulo, one of the best hackers I have met. Nikon FM2 50mm1.2f, Kodak E100G film, double exposure.\" /></p>\n<p>We saw that Set construction and presence checking are extremely fast operations when compared to their Array counterparts. With this in mind the set operations can be easily and naively done.</p>\n<h3 id=\"union\">Union</h3>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">union </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Set</span><span style=\"color:#c0c5ce;\">([...</span><span style=\"color:#bf616a;\">set1</span><span style=\"color:#c0c5ce;\">, ...</span><span style=\"color:#bf616a;\">set2</span><span style=\"color:#c0c5ce;\">]);\n</span></code></pre>\n<p>Creates a new set with the <em>unique</em> values on set1 and set2 (no repeated values). If you don't care about uniqueness then just use Arrays and <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/concat\"><code>concat()</code></a> them.</p>\n<h3 id=\"difference\">Difference</h3>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">diff </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Set</span><span style=\"color:#c0c5ce;\">([...</span><span style=\"color:#bf616a;\">set1</span><span style=\"color:#c0c5ce;\">].</span><span style=\"color:#bf616a;\">filter</span><span style=\"color:#c0c5ce;\">(x </span><span style=\"color:#b48ead;\">=&gt; </span><span style=\"color:#c0c5ce;\">!</span><span style=\"color:#bf616a;\">set2</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">has</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">x</span><span style=\"color:#c0c5ce;\">)));\n</span></code></pre><h3 id=\"intersection\">Intersection</h3>\n<pre style=\"background-color:#2b303b;\">\n<code><span style=\"color:#b48ead;\">const </span><span style=\"color:#bf616a;\">intersected </span><span style=\"color:#c0c5ce;\">= new </span><span style=\"color:#ebcb8b;\">Set</span><span style=\"color:#c0c5ce;\">([...</span><span style=\"color:#bf616a;\">set1</span><span style=\"color:#c0c5ce;\">].</span><span style=\"color:#bf616a;\">filter</span><span style=\"color:#c0c5ce;\">(x </span><span style=\"color:#b48ead;\">=&gt; </span><span style=\"color:#bf616a;\">set2</span><span style=\"color:#c0c5ce;\">.</span><span style=\"color:#bf616a;\">has</span><span style=\"color:#c0c5ce;\">(</span><span style=\"color:#bf616a;\">x</span><span style=\"color:#c0c5ce;\">)));\n</span></code></pre>\n<p>Simple as long as you remember that for objects they work with references instead of values.</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<ul>\n<li>Use Set() when unique values matter</li>\n<li>Set.has() is much faster than Array.indexOf()</li>\n<li>Array.push() is much faster than Set.add()</li>\n<li>Arrays are faster to iterate sequentially</li>\n<li>Union, Difference, Intersection are easy to implement with Set</li>\n</ul>\n<p>Set's are a big part of my project <a href=\"https://gridgenerator.com\">Grid Generator</a>. Keeping these small concepts close to the heart can help you leverage Sets to achieve very good performance even in mobile devices.</p>\n<p>I hope this post was valuable in any way to you. If you are interested <a href=\"https://hugodaniel.com/posts/mastering-console-log/\">here is my take on console.log()</a> and also a <a href=\"https://hugodaniel.com/posts/in-loving-memory-of-immutable/\">look into Immutable</a>.</p>\n",
    "permalink": "https://hugodaniel.com/posts/how-useful-is-the-javascript-set/",
    "slug": "how-useful-is-the-javascript-set",
    "ancestors": [
      "_index.md",
      "posts/_index.md"
    ],
    "title": "How useful is the JavaScript Set",
    "description": "Working, playing and measuring the JavaScript Set data structure",
    "updated": null,
    "date": "2017-10-25",
    "year": 2017,
    "month": 10,
    "day": 25,
    "taxonomies": {},
    "extra": {
      "place": "Lisboa",
      "author": "Hugo Daniel"
    },
    "path": "/posts/how-useful-is-the-javascript-set/",
    "components": [
      "posts",
      "how-useful-is-the-javascript-set"
    ],
    "summary": null,
    "toc": [
      {
        "level": 2,
        "id": "initialization",
        "permalink": "https://hugodaniel.com/posts/how-useful-is-the-javascript-set/#initialization",
        "title": "Initialization",
        "children": []
      },
      {
        "level": 2,
        "id": "uniqueness",
        "permalink": "https://hugodaniel.com/posts/how-useful-is-the-javascript-set/#uniqueness",
        "title": "Uniqueness",
        "children": []
      },
      {
        "level": 2,
        "id": "presence",
        "permalink": "https://hugodaniel.com/posts/how-useful-is-the-javascript-set/#presence",
        "title": "Presence",
        "children": []
      },
      {
        "level": 2,
        "id": "insertion-speed",
        "permalink": "https://hugodaniel.com/posts/how-useful-is-the-javascript-set/#insertion-speed",
        "title": "Insertion speed",
        "children": []
      },
      {
        "level": 2,
        "id": "iteration-speed",
        "permalink": "https://hugodaniel.com/posts/how-useful-is-the-javascript-set/#iteration-speed",
        "title": "Iteration speed",
        "children": []
      },
      {
        "level": 2,
        "id": "set-operations",
        "permalink": "https://hugodaniel.com/posts/how-useful-is-the-javascript-set/#set-operations",
        "title": "Set operations",
        "children": [
          {
            "level": 3,
            "id": "union",
            "permalink": "https://hugodaniel.com/posts/how-useful-is-the-javascript-set/#union",
            "title": "Union",
            "children": []
          },
          {
            "level": 3,
            "id": "difference",
            "permalink": "https://hugodaniel.com/posts/how-useful-is-the-javascript-set/#difference",
            "title": "Difference",
            "children": []
          },
          {
            "level": 3,
            "id": "intersection",
            "permalink": "https://hugodaniel.com/posts/how-useful-is-the-javascript-set/#intersection",
            "title": "Intersection",
            "children": []
          }
        ]
      },
      {
        "level": 2,
        "id": "conclusion",
        "permalink": "https://hugodaniel.com/posts/how-useful-is-the-javascript-set/#conclusion",
        "title": "Conclusion",
        "children": []
      }
    ],
    "word_count": 1762,
    "reading_time": 9,
    "assets": [],
    "draft": false,
    "lang": "en",
    "lighter": null,
    "heavier": null,
    "earlier": {
      "relative_path": "posts/2017-10-25-Lisbon-as-an-inspiration-for-my-project.md",
      "content": "<p><img src=\"/images/Lisbon_gridgenerator1.jpg\" alt=\"Diptych of Lisbon graffitti in portuguese tiles together with the downtown Lisbon ground\" /></p>\n<p>Recently I was somewhat &quot;forced&quot; to think about the story behind the idea I am working on. If you go to these startup and entrepreneurship events you will see that most projects have some kind of a story behind them.\nEither they start up in a garage (Apple), or they decided to improve their hobbyist girl discrimination app (facebook), or they just somehow were blessed by some mystical event that got their idea and team together to disrupt the universe.</p>\n<p>When my reality clashed with that one I realized that I did not have a special motivation to do a <a href=\"https://gridgenerator.com\">pattern and shapes app</a> besides my desire to make a cool project come to life.\nSo I decided to do what it seemed like the best approach to move forward: I lead myself into a spiral of paranoia and depression for not taking in consideration the necessary planets alignment.</p>\n<p>Afterall, why am I doing what I am doing ? Why drawing ? Why shapes and patterns ? What is my story ? How do I sell my idea ? What drives my &quot;pitch&quot; ?\nAll entrepreneurs seem to have the answers for these questions well sorted out as they always come up with some amazing tale of fortune and success.</p>\n<p>Me?\nI am just a person who worked in the public sector for 6 years. Quit out of frustration. Worked 2 months for a consulting company. Quit out of more frustration. Worked less than a year in a startup and quit to avoid medical insanity.</p>\n<p><img src=\"/images/Lisbon_gridgenerator2.jpg\" alt=\"A random person walking downwards with a building frontage covered in tiles in the background\" /></p>\n<p>Since college that I am full of myself with photography. I really think that I am the last Coca-Cola in the desert in regards to photography.\nInstead of studying for the exams I would spend hours roaming around Lisbon and taking pictures of every little bit of this city. I would then proceed to use them to produce poems that were even more pretentious than the pictures.\nWhich inevitably led me to fail a lot of years in university. I have pictures to show for it :)</p>\n<p>Lucky for me Lisbon is one of the most beautiful cities in the world, so some pictures turned out ok in spite of my lack of talent for photography. The ones that were good were mostly about:</p>\n<ol>\n<li>Tagus scenery (hard to miss)</li>\n<li>Buildings frontages</li>\n<li>Portuguese sidewalks</li>\n</ol>\n<p><img src=\"/images/Lisbon_gridgenerator3.jpg\" alt=\"A building in Lisbon\" /></p>\n<p>The ammount of patterns and small details in Lisbon is impressive. Be it on the walls, or on the ground, or inside or outside of buildings. I guess this is the only explanation I can think of for my interest in shapes and geometric patterns.</p>\n<p>In a few days Lisbon will be full of people from different culture(s) who are coming in for the WebSummit. If you are visiting don't forget to look at the floors and walls.\nThey are a source of inspiration.</p>\n<p><img src=\"/images/Lisbon_gridgenerator4.jpg\" alt=\"Diptych of a messed up sidewalk diagonal grid and the door detail of a church in &quot;Martim Moniz&quot; where the frontage is entirely rendered on the ground sidewalk\" /></p>\n<p>If you liked this post <a href=\"https://gridgenerator.com\">check out my project</a> and the reason why <a href=\"https://hugodaniel.com/posts/why-i-decided-to-go-to-the-websummit/\">I am going to the WebSummit</a></p>\n",
      "permalink": "https://hugodaniel.com/posts/lisbon-as-an-inspiration-for-my-project/",
      "slug": "lisbon-as-an-inspiration-for-my-project",
      "ancestors": [
        "_index.md",
        "posts/_index.md"
      ],
      "title": "Lisbon as an inspiration for my project",
      "description": "How Lisbon became an inspiration for the current idea I am working on",
      "updated": null,
      "date": "2017-10-25",
      "year": 2017,
      "month": 10,
      "day": 25,
      "taxonomies": {},
      "extra": {
        "place": "Lisboa",
        "author": "Hugo Daniel"
      },
      "path": "/posts/lisbon-as-an-inspiration-for-my-project/",
      "components": [
        "posts",
        "lisbon-as-an-inspiration-for-my-project"
      ],
      "summary": null,
      "toc": [],
      "word_count": 577,
      "reading_time": 3,
      "assets": [],
      "draft": false,
      "lang": "en",
      "lighter": null,
      "heavier": null,
      "earlier": null,
      "later": null,
      "translations": []
    },
    "later": {
      "relative_path": "posts/2017-10-31-first-funding-as-a-bootstrapper-in-portugal.md",
      "content": "<p><img src=\"/images/startupvoucher.jpg\" alt=\"StartUp Voucher ad, it reads: &quot;What if your idea could turn into a company ?&quot;\" /></p>\n<p>In April 2016 I quit from the startup I was working to finally do a personal project. Back then the questions everyone asked me were mostly about money <em>&quot;How are you going to live ?&quot;</em>.\nEven though rent prices in Lisbon have been skyrocketing due to tourism increase and the coming of WebSummit I always had a frugal economical lifestyle. I don't have loans, I don't have &quot;luxuries&quot; and I can keep my monthly spendings to what some people view as an heroically low value.\nLooking back it was somewhat natural that when a set of conditions met I thought: &quot;it's now or never&quot;.</p>\n<p>I spent some months wondering about what kind of project to do. I knew I wanted something ambitious but I got easily lost in the objectives and purpose of the project. With time I realized that the money I had saved was not going to allow me to survive long enough to do a first version of the product and release it in the market.\nThat made me start looking around for investment, preferably some that did not imply selling part of the company (lost fund). That was when I found about StartUp Voucher.</p>\n<p>Very briefly, StartUp Voucher is a community fund from the European Union that is run by the Portuguese Gov. with the purpose of helping out companies in &quot;idea stage&quot;. Pragmatically this means I get 690EUR/month for 12 months plus the help of an incubator and a mentor.</p>\n<p>This funding is particularly targeted for ideas outside of the most developed areas of the country. In spite of currently living in Lisbon I was born and raised in Alenquer, where my family still resides. To apply for this fund I made the headquarters of my project there, a place I love and visit on a weekly basis.</p>\n<p>To further enhance my application I read through the whole 100 page <a href=\"https://www.portugal2020.pt/Portal2020/Media/Default/Docs/EstrategiasEInteligente/EREI%20Centro.pdf\">&quot;Research and Innovation Strategies for Smart Specialisation&quot; report (RIS3)</a> for my region. That report made me notice that a software tool for grid based drawings could have a lot of impact in several practical applications for the exporting industries in the Center of Portugal. Like ceramics, textiles and creative industries.</p>\n<p><a href=\"https://gridgenerator.com\"><img src=\"https://gridgenerator.com/img/logo/grid_generator_logo.png\" alt=\"The logo\" /></a></p>\n<p>When Lisbon was boiling with WebSummit 2016 I was working full-time to apply to this fund. It took me a few weeks and in December I finally finished the application and sent it. After a some months I got the news that my project was one of the 245 chosen to be on the StartUp Voucher. Since around May 2017 that I have been getting 690EUR each month and working in full force on this project.</p>\n<p>During this time I have been using their support to fine-tune the project in many ways and prepare myself for the first steps on the market. WebSummit is also being promoted by the StartUp Voucher who encourages all tech startups to try to attend.</p>\n<p>Right now I have a working demo that have been using with some friends and potential users and I am planning to start looking for partnerships in early 2018.</p>\n<p><a href=\"https://hugodaniel.com/posts/why-i-decided-to-go-to-the-websummit/\">In this link</a> I explain why I decided to go to the WebSummit this year.</p>\n",
      "permalink": "https://hugodaniel.com/posts/first-funding-as-a-bootstrapper-in-portugal/",
      "slug": "first-funding-as-a-bootstrapper-in-portugal",
      "ancestors": [
        "_index.md",
        "posts/_index.md"
      ],
      "title": "My first funding as a bootstrapper in Portugal",
      "description": "A brief summary of StartUp Voucher as a potential funding for portuguese bootstrappers",
      "updated": null,
      "date": "2017-10-31",
      "year": 2017,
      "month": 10,
      "day": 31,
      "taxonomies": {},
      "extra": {
        "place": "Lisboa",
        "author": "Hugo Daniel"
      },
      "path": "/posts/first-funding-as-a-bootstrapper-in-portugal/",
      "components": [
        "posts",
        "first-funding-as-a-bootstrapper-in-portugal"
      ],
      "summary": null,
      "toc": [],
      "word_count": 578,
      "reading_time": 3,
      "assets": [],
      "draft": false,
      "lang": "en",
      "lighter": null,
      "heavier": null,
      "earlier": null,
      "later": null,
      "translations": []
    },
    "translations": []
  }
});
		</script>
	-->
	</body>
</html>
